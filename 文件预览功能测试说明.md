# 📁 文件预览功能测试说明

## 🎯 测试目标
验证申请者提交页面的文件上传功能与管理者验收管理中心页面的文件预览功能能够正常联通和互动。

## 🚀 前置准备
1. 确保项目已启动：`npm run dev`
2. 访问地址：http://localhost:5174/
3. 准备测试文件：
   - **PDF文档**：任意PDF文件（如技术文档、报告等）
   - **Word文档**：.doc或.docx文件  
   - **PowerPoint文档**：.ppt或.pptx文件
   - **Excel文档**：.xls或.xlsx文件
   - **图片文件**：.jpg、.png、.gif等格式
   - **压缩包**：.zip或.rar文件

## 📋 测试步骤

### 第一步：申请者角色 - 文件上传测试

1. **进入申请提交页面**
   ```
   导航路径：项目验收 → 申报单位角色 → 提交验收申请
   URL：http://localhost:5174/acceptance/application/submit
   ```

2. **上传测试文件**
   - 在"必需材料"区域，点击"选择文件"按钮
   - 选择准备好的各种格式文件进行上传
   - 观察上传后的文件列表显示是否正确
   - 测试"预览"按钮功能，验证预览弹窗是否正常打开
   - 测试"下载"按钮功能，验证下载是否正常
   - 测试"删除"按钮功能，验证删除是否正常

3. **验证文件信息显示**
   - 检查文件名、文件大小显示是否正确
   - 检查文件图标是否匹配文件类型
   - 检查文件操作按钮是否齐全（预览、下载、删除）

### 第二步：管理者角色 - 文件审核测试

1. **进入验收管理中心**
   ```
   导航路径：项目验收 → 管理角色 → 验收管理中心  
   URL：http://localhost:5174/acceptance/management/center
   ```

2. **材料审核测试**
   - 在项目列表中选择第一个项目（智慧城市大数据平台建设项目）
   - 点击"审核材料"按钮，打开材料详情弹窗
   - 在材料列表中点击"预览"按钮，测试文件预览功能
   - 测试不同文件格式的预览效果：
     * PDF：应显示PDF查看器，支持缩放、翻页
     * Word/PPT：应尝试使用Office Online预览
     * Excel：应尝试使用在线表格预览
     * 图片：应显示图片查看器，支持缩放
     * 压缩包：应提示不支持预览，提供下载选项

3. **预览功能详细测试**
   - **PDF预览**：测试缩放(+/-)、页面导航(前/后)、全屏查看
   - **Office文档**：测试新窗口打开、刷新预览、转换预览
   - **图片预览**：测试缩放、适应窗口、图片质量
   - **通用功能**：测试文件下载、刷新预览、关闭弹窗

## 🔍 功能验证点

### ✅ 申请者页面功能验证
- [ ] 文件上传功能正常
- [ ] 文件列表显示正确（名称、大小、图标）
- [ ] 预览按钮能正常打开预览弹窗
- [ ] 下载按钮能正常下载文件
- [ ] 删除按钮能正常删除文件
- [ ] 文件格式限制生效(.pdf,.doc,.docx,.zip,.rar)
- [ ] 上传状态显示正确

### ✅ 管理者页面功能验证
- [ ] 项目列表正常显示
- [ ] 材料审核弹窗正常打开
- [ ] 材料列表显示所有上传文件
- [ ] 预览功能支持多种文件格式
- [ ] PDF预览工具栏功能完整（缩放、翻页）
- [ ] Office文档预览能正常加载
- [ ] 图片预览支持缩放操作
- [ ] 不支持的格式提示下载
- [ ] 下载功能正常工作

### ✅ 预览组件功能验证
- [ ] 预览弹窗大小合适（90%宽度）
- [ ] 文件信息头部显示完整
- [ ] 各种文件类型图标和标签正确
- [ ] 加载状态显示正常
- [ ] 错误处理机制工作
- [ ] 响应式设计适配移动端

## 🛠️ 技术实现验证

### 前端组件联通性
1. **FilePreview组件**：独立的文件预览组件，支持多种格式
2. **申请提交页面**：集成文件上传和预览功能
3. **验收管理中心**：集成文件审核和预览功能
4. **数据传递**：文件信息在不同组件间正确传递

### 支持的文件格式
- **PDF**：使用iframe直接预览或PDF.js
- **Word/PPT/Excel**：使用Office Online Viewer
- **图片**：原生HTML img标签
- **其他格式**：提供下载选项

## 🐛 常见问题排查

### 1. 预览弹窗不显示
- 检查控制台是否有JavaScript错误
- 检查文件URL是否正确
- 检查FilePreview组件导入是否正确

### 2. Office文档预览失败
- **原因**：Office Online服务只能预览公网可访问的文件URL
- **现象**：显示"An error occurred"错误页面
- **解决方案**：
  - 本地文件会自动显示友好的提示界面
  - 提供"下载文件查看"和"尝试本地预览"选项
  - 用户可以下载文件后使用本地Office软件打开
- **技术限制**：浏览器安全策略限制iframe加载本地文件

### 3. 文件上传后不显示
- 检查文件大小限制
- 检查文件格式是否在允许列表中
- 检查文件列表更新逻辑

### 4. 下载功能异常
- 检查文件URL配置
- 检查浏览器下载设置
- 检查CORS跨域配置

## 📊 测试报告模板

```
测试时间：____年__月__日
测试环境：Windows/Mac/Linux + Chrome/Firefox/Safari
测试结果：

申请者页面：
□ 文件上传：通过/失败
□ 文件预览：通过/失败  
□ 文件下载：通过/失败
□ 文件删除：通过/失败

管理者页面：
□ 材料列表：通过/失败
□ PDF预览：通过/失败
□ Word预览：通过/失败
□ 图片预览：通过/失败
□ 下载功能：通过/失败

发现问题：
1. ________________________
2. ________________________
3. ________________________

建议改进：
1. ________________________
2. ________________________
3. ________________________
```

## 🎉 成功标准

当以下条件全部满足时，文件预览功能测试通过：

1. ✅ 申请者能够正常上传各种格式的文件
2. ✅ 申请者能够在上传后立即预览文件内容
3. ✅ 管理者能够查看申请者上传的所有文件
4. ✅ 管理者能够正常预览不同格式的文件
5. ✅ PDF文件预览功能完整（缩放、翻页等）
6. ✅ 图片文件预览清晰且支持缩放
7. ✅ 不支持的文件格式有明确提示
8. ✅ 下载功能在两个角色页面都正常工作
9. ✅ 预览弹窗界面美观且用户友好
10. ✅ 整个流程用户体验流畅自然

## 🔄 持续改进

根据测试结果，可以考虑以下改进方向：

1. **性能优化**：大文件预览加载速度优化
2. **格式支持**：增加更多文件格式支持
3. **用户体验**：优化预览界面和操作流程
4. **错误处理**：完善各种异常情况的处理
5. **移动端适配**：优化移动设备上的预览体验

---

**开始测试，享受无缝的文件预览体验！** 🚀 