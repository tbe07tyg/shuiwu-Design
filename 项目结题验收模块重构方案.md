# 🎯 项目结题验收独立模块重构方案

## 📋 方案概述

将项目验收从"项目实施"模块中独立出来，作为项目生命周期的独立阶段，提升项目结题验收的专业性和完整性。

## 🌲 新的菜单结构设计

### 重构后的完整菜单结构：
```
📋 项目管理
├── 📊 项目调研
│   ├── 需求池管理
│   └── 调研记录
├── 🏅 项目立项  
│   ├── 立项管理中心
│   ├── 申请材料管理
│   ├── 立项论证会
│   └── 已立项的项目
├── ⚙️ 项目实施
│   ├── 项目实施管理中心
│   ├── 项目开题
│   ├── 项目中期
│   ├── 合同管理
│   ├── 经费执行进度
│   └── 进度监控
├── 🎯 项目结题验收 ← 新的独立模块
│   ├── 验收管理中心
│   ├── 材料提交
│   ├── 专家评审
│   ├── 验收会议
│   ├── 结果公示
│   └── 归档管理
├── 🏆 成果管理
├── 📈 统计分析
├── 📚 知识库管理
├── 🔧 日常维护
└── ⚙️ 系统设置
```

## 📁 文件结构调整方案

### 新建目录结构
```
src/views/acceptance/                    # 新的验收模块根目录
├── index.vue                          # 验收管理中心（总览页面）
├── components/                         # 验收专用组件
│   ├── AcceptanceStatCard.vue         # 验收统计卡片
│   ├── MaterialManager.vue            # 材料管理组件
│   ├── ExpertPanel.vue               # 专家管理面板
│   ├── ProcessFlow.vue               # 流程跟踪组件
│   └── EvaluationReport.vue          # 评估报告组件
├── materials/                          # 材料提交子模块
│   ├── index.vue                      # 材料提交主页
│   ├── Upload.vue                     # 文件上传页面
│   └── Review.vue                     # 材料审核页面
├── experts/                           # 专家评审子模块
│   ├── index.vue                      # 专家管理主页
│   ├── Assignment.vue                 # 专家分配页面
│   └── Evaluation.vue                 # 专家评审页面
├── meetings/                          # 验收会议子模块
│   ├── index.vue                      # 会议管理主页
│   ├── Schedule.vue                   # 会议安排页面
│   └── Minutes.vue                    # 会议纪要页面
├── results/                           # 结果公示子模块
│   ├── index.vue                      # 结果公示主页
│   └── Appeals.vue                    # 异议处理页面
└── archive/                           # 归档管理子模块
    ├── index.vue                      # 归档管理主页
    └── Documents.vue                  # 文档归档页面
```

### 移动现有文件
```bash
# 将现有验收相关文件移动到新目录
src/views/implementation/acceptance/ → src/views/acceptance/materials/
```

## 🛠️ 代码修改步骤

### 步骤1：更新路由配置

**文件：src/router/index.js**
```javascript
// 新增验收模块路由
{
  path: 'acceptance',
  name: 'Acceptance',
  component: () => import('@/views/acceptance/index.vue'),
  meta: {
    title: '项目结题验收',
    icon: 'CheckCircleOutlined'
  }
},
{
  path: 'acceptance/materials',
  name: 'AcceptanceMaterials',
  component: () => import('@/views/acceptance/materials/index.vue'),
  meta: {
    title: '材料提交',
    icon: 'FileAddOutlined'
  }
},
{
  path: 'acceptance/experts',
  name: 'AcceptanceExperts',
  component: () => import('@/views/acceptance/experts/index.vue'),
  meta: {
    title: '专家评审',
    icon: 'UserOutlined'
  }
},
{
  path: 'acceptance/meetings',
  name: 'AcceptanceMeetings',
  component: () => import('@/views/acceptance/meetings/index.vue'),
  meta: {
    title: '验收会议',
    icon: 'VideoCameraOutlined'
  }
},
{
  path: 'acceptance/results',
  name: 'AcceptanceResults',
  component: () => import('@/views/acceptance/results/index.vue'),
  meta: {
    title: '结果公示',
    icon: 'NotificationOutlined'
  }
},
{
  path: 'acceptance/archive',
  name: 'AcceptanceArchive',
  component: () => import('@/views/acceptance/archive/index.vue'),
  meta: {
    title: '归档管理',
    icon: 'FolderOutlined'
  }
}

// 删除原有的实施模块中的验收路由
// 删除：implementation/acceptance 相关路由
```

### 步骤2：更新菜单配置

**文件：src/layout/Layout.vue**
```vue
<!-- 在项目实施子菜单中删除验收相关项目 -->
<a-sub-menu key="project-implementation">
  <template #title>
    <SettingOutlined style="margin-right:8px;" />
    <span>项目实施</span>
    <div class="urgent-tag" v-if="hasUrgentImplementation">🔴</div>
  </template>
  <a-menu-item key="implementation-center">
    <AppstoreOutlined style="margin-right:8px;" />
    <span>项目实施管理中心</span>
  </a-menu-item>
  <a-menu-item key="implementation-opening" @click.stop="showDrawer('opening')">
    <RocketOutlined style="margin-right:8px;" />
    <span>项目开题</span>
  </a-menu-item>
  <a-menu-item key="implementation-midterm" @click.stop="showDrawer('midterm')">
    <PieChartOutlined style="margin-right:8px;" />
    <span>项目中期</span>
  </a-menu-item>
  <!-- 删除项目验收菜单项 -->
  <a-menu-item key="implementation-contract">
    <ContainerOutlined style="margin-right:8px;" />
    <span>合同管理</span>
  </a-menu-item>
  <a-menu-item key="implementation-payment">
    <DollarOutlined style="margin-right:8px;" />
    <span>经费执行进度</span>
  </a-menu-item>
  <a-menu-item key="implementation-progress">
    <BarChartOutlined style="margin-right:8px;" />
    <span>进度监控</span>
  </a-menu-item>
</a-sub-menu>

<!-- 新增项目结题验收子菜单 -->
<a-sub-menu key="project-acceptance">
  <template #title>
    <CheckCircleOutlined style="margin-right:8px;" />
    <span>项目结题验收</span>
    <div class="urgent-tag" v-if="hasUrgentAcceptance">🔴</div>
  </template>
  <a-menu-item key="acceptance-center">
    <DashboardOutlined style="margin-right:8px;" />
    <span>验收管理中心</span>
    <span class="item-count">({{ counts.acceptance }})</span>
  </a-menu-item>
  <a-menu-item key="acceptance-materials">
    <FileAddOutlined style="margin-right:8px;" />
    <span>材料提交</span>
    <span class="item-count">({{ counts.materials }})</span>
  </a-menu-item>
  <a-menu-item key="acceptance-experts">
    <UserOutlined style="margin-right:8px;" />
    <span>专家评审</span>
    <span class="item-count">({{ counts.experts }})</span>
  </a-menu-item>
  <a-menu-item key="acceptance-meetings">
    <VideoCameraOutlined style="margin-right:8px;" />
    <span>验收会议</span>
    <span class="item-count">({{ counts.meetings }})</span>
  </a-menu-item>
  <a-menu-item key="acceptance-results">
    <NotificationOutlined style="margin-right:8px;" />
    <span>结果公示</span>
    <span class="item-count">({{ counts.results }})</span>
  </a-menu-item>
  <a-menu-item key="acceptance-archive">
    <FolderOutlined style="margin-right:8px;" />
    <span>归档管理</span>
    <span class="item-count">({{ counts.archive }})</span>
  </a-menu-item>
</a-sub-menu>
```

### 步骤3：创建验收管理中心页面

**文件：src/views/acceptance/index.vue**
```vue
<template>
  <div class="acceptance-center-page">
    <!-- 页面头部 -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">
          <CheckCircleOutlined /> 项目结题验收管理中心
        </h1>
        <p class="page-desc">统一管理项目结题验收全流程，包括材料提交、专家评审、会议组织、结果公示、归档管理</p>
      </div>
      <div class="header-actions">
        <a-button type="primary" @click="handleNewAcceptance">
          <PlusOutlined /> 新建验收
        </a-button>
        <a-button @click="handleExport">
          <ExportOutlined /> 导出报告
        </a-button>
      </div>
    </div>

    <!-- 验收统计概览 -->
    <div class="stats-section">
      <a-row :gutter="24">
        <a-col :span="6">
          <AcceptanceStatCard
            title="待验收项目"
            :value="stats.pending"
            color="#1890ff"
            icon="ClockCircleOutlined"
            @click="filterByStatus('pending')"
          />
        </a-col>
        <a-col :span="6">
          <AcceptanceStatCard
            title="评审中项目"
            :value="stats.reviewing"
            color="#52c41a"
            icon="AuditOutlined"
            @click="filterByStatus('reviewing')"
          />
        </a-col>
        <a-col :span="6">
          <AcceptanceStatCard
            title="已通过项目"
            :value="stats.passed"
            color="#722ed1"
            icon="CheckCircleOutlined"
            @click="filterByStatus('passed')"
          />
        </a-col>
        <a-col :span="6">
          <AcceptanceStatCard
            title="总验收金额"
            :value="formatCurrency(stats.totalAmount)"
            color="#fa8c16"
            icon="DollarOutlined"
          />
        </a-col>
      </a-row>
    </div>

    <!-- 验收项目列表 -->
    <a-card title="验收项目管理" class="project-table-card">
      <template #extra>
        <a-space>
          <a-input-search
            v-model:value="searchKeyword"
            placeholder="搜索项目名称"
            style="width: 250px"
            @search="handleSearch"
          />
          <a-select
            v-model:value="statusFilter"
            placeholder="验收状态"
            style="width: 120px"
            @change="handleStatusFilter"
          >
            <a-select-option value="">全部</a-select-option>
            <a-select-option value="pending">待验收</a-select-option>
            <a-select-option value="reviewing">评审中</a-select-option>
            <a-select-option value="passed">已通过</a-select-option>
            <a-select-option value="rejected">未通过</a-select-option>
          </a-select>
        </a-space>
      </template>

      <a-table
        :columns="columns"
        :data-source="filteredProjects"
        :pagination="pagination"
        :loading="loading"
        rowKey="id"
      >
        <template #bodyCell="{ column, record }">
          <template v-if="column.key === 'status'">
            <a-tag :color="getStatusColor(record.status)">
              {{ getStatusText(record.status) }}
            </a-tag>
          </template>
          <template v-else-if="column.key === 'progress'">
            <a-progress
              :percent="record.progress"
              :size="'small'"
              :status="record.progress === 100 ? 'success' : 'active'"
            />
          </template>
          <template v-else-if="column.key === 'actions'">
            <a-space>
              <a-button type="link" size="small" @click="handleViewProject(record)">
                详情
              </a-button>
              <a-button type="link" size="small" @click="handleManageMaterials(record)">
                材料管理
              </a-button>
              <a-button type="link" size="small" @click="handleManageExperts(record)">
                专家评审
              </a-button>
              <a-button type="link" size="small" @click="handleScheduleMeeting(record)">
                会议安排
              </a-button>
              <a-dropdown>
                <template #overlay>
                  <a-menu @click="handleMoreAction($event, record)">
                    <a-menu-item key="results">结果公示</a-menu-item>
                    <a-menu-item key="archive">归档管理</a-menu-item>
                    <a-menu-item key="report">生成报告</a-menu-item>
                  </a-menu>
                </template>
                <a-button type="link" size="small">
                  更多 <DownOutlined />
                </a-button>
              </a-dropdown>
            </a-space>
          </template>
        </template>
      </a-table>
    </a-card>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { message } from 'ant-design-vue'
import AcceptanceStatCard from './components/AcceptanceStatCard.vue'

const router = useRouter()

// 数据状态
const loading = ref(false)
const searchKeyword = ref('')
const statusFilter = ref('')

// 统计数据
const stats = ref({
  pending: 12,
  reviewing: 8,
  passed: 45,
  totalAmount: 12500000
})

// 表格列配置
const columns = [
  { title: '项目名称', dataIndex: 'name', key: 'name', width: 200 },
  { title: '项目负责人', dataIndex: 'leader', key: 'leader', width: 100 },
  { title: '验收状态', dataIndex: 'status', key: 'status', width: 100 },
  { title: '验收进度', dataIndex: 'progress', key: 'progress', width: 120 },
  { title: '申请时间', dataIndex: 'applyDate', key: 'applyDate', width: 120 },
  { title: '计划验收时间', dataIndex: 'planDate', key: 'planDate', width: 120 },
  { title: '项目金额', dataIndex: 'amount', key: 'amount', width: 100 },
  { title: '操作', key: 'actions', width: 300, fixed: 'right' }
]

// 项目数据
const projects = ref([
  {
    id: 'ACC001',
    name: '智能制造技术研发项目',
    leader: '张工程师',
    status: 'pending',
    progress: 75,
    applyDate: '2024-12-01',
    planDate: '2024-12-31',
    amount: 2000000
  },
  {
    id: 'ACC002',
    name: 'AI算法优化项目',
    leader: '李博士',
    status: 'reviewing',
    progress: 85,
    applyDate: '2024-11-15',
    planDate: '2024-11-30',
    amount: 1500000
  }
])

// 分页配置
const pagination = ref({
  current: 1,
  pageSize: 10,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `共 ${total} 条记录`
})

// 过滤后的项目列表
const filteredProjects = computed(() => {
  let result = projects.value
  
  if (searchKeyword.value) {
    result = result.filter(project => 
      project.name.toLowerCase().includes(searchKeyword.value.toLowerCase())
    )
  }
  
  if (statusFilter.value) {
    result = result.filter(project => project.status === statusFilter.value)
  }
  
  return result
})

// 工具函数
const formatCurrency = (amount) => {
  return `¥${(amount / 1000000).toFixed(1)}M`
}

const getStatusColor = (status) => {
  const colors = {
    pending: 'orange',
    reviewing: 'blue',
    passed: 'green',
    rejected: 'red'
  }
  return colors[status] || 'default'
}

const getStatusText = (status) => {
  const texts = {
    pending: '待验收',
    reviewing: '评审中',
    passed: '已通过',
    rejected: '未通过'
  }
  return texts[status] || '未知'
}

// 事件处理
const handleNewAcceptance = () => {
  router.push('/acceptance/materials')
}

const handleExport = () => {
  message.success('导出功能开发中...')
}

const filterByStatus = (status) => {
  statusFilter.value = status
}

const handleSearch = () => {
  // 搜索逻辑已在计算属性中处理
}

const handleStatusFilter = () => {
  // 过滤逻辑已在计算属性中处理
}

const handleViewProject = (record) => {
  message.info(`查看项目详情: ${record.name}`)
}

const handleManageMaterials = (record) => {
  router.push(`/acceptance/materials?projectId=${record.id}`)
}

const handleManageExperts = (record) => {
  router.push(`/acceptance/experts?projectId=${record.id}`)
}

const handleScheduleMeeting = (record) => {
  router.push(`/acceptance/meetings?projectId=${record.id}`)
}

const handleMoreAction = ({ key }, record) => {
  switch (key) {
    case 'results':
      router.push(`/acceptance/results?projectId=${record.id}`)
      break
    case 'archive':
      router.push(`/acceptance/archive?projectId=${record.id}`)
      break
    case 'report':
      message.success('生成报告功能开发中...')
      break
  }
}

onMounted(() => {
  // 加载数据
  pagination.value.total = projects.value.length
})
</script>

<style lang="scss" scoped>
.acceptance-center-page {
  padding: 24px;
  background: #f5f7fa;
  min-height: 100vh;

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    background: #fff;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(35,79,162,0.06);

    .header-content {
      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1f2937;
        margin: 0 0 8px 0;
      }

      .page-desc {
        color: #6b7280;
        margin: 0;
        font-size: 14px;
      }
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }
  }

  .stats-section {
    margin-bottom: 24px;
  }

  .project-table-card {
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(35,79,162,0.06);
  }
}
</style>
```

## 🔄 数据流转调整

### 验收模块数据流设计
```
项目实施完成 → 提交验收申请 → 材料准备 → 专家评审 → 验收会议 → 结果公示 → 归档管理
    ↑               ↓            ↓         ↓         ↓         ↓         ↓
进度监控数据    材料检查完整性    专家分配    会议安排    结果确认    文档归档    成果管理
```

### Store状态管理
```javascript
// src/store/acceptance.js
import { defineStore } from 'pinia'

export const useAcceptanceStore = defineStore('acceptance', {
  state: () => ({
    // 验收项目列表
    acceptanceList: [],
    // 当前验收项目
    currentProject: null,
    // 验收统计数据
    stats: {
      pending: 0,
      reviewing: 0,
      passed: 0,
      rejected: 0,
      totalAmount: 0
    },
    // 专家库
    expertPool: [],
    // 材料模板
    materialTemplates: []
  }),
  
  actions: {
    // 获取验收项目列表
    async fetchAcceptanceList() {
      // API调用逻辑
    },
    
    // 提交验收申请
    async submitAcceptanceApplication(projectData) {
      // API调用逻辑
    },
    
    // 分配专家
    async assignExperts(projectId, expertIds) {
      // API调用逻辑
    },
    
    // 更新验收状态
    async updateAcceptanceStatus(projectId, status) {
      // API调用逻辑
    }
  }
})
```

## 📊 业务流程优化

### 验收流程状态机
```javascript
// 验收状态流转
const ACCEPTANCE_STATES = {
  'draft': { // 草稿
    next: ['submitted'],
    actions: ['edit', 'delete', 'submit']
  },
  'submitted': { // 已提交
    next: ['material_review'],
    actions: ['view', 'recall']
  },
  'material_review': { // 材料审核
    next: ['expert_assign', 'material_rejected'],
    actions: ['review', 'approve', 'reject']
  },
  'material_rejected': { // 材料被退回
    next: ['submitted'],
    actions: ['modify', 'resubmit']
  },
  'expert_assign': { // 专家分配
    next: ['expert_review'],
    actions: ['assign_experts', 'schedule_meeting']
  },
  'expert_review': { // 专家评审
    next: ['meeting_scheduled'],
    actions: ['evaluate', 'provide_opinion']
  },
  'meeting_scheduled': { // 会议安排
    next: ['meeting_completed'],
    actions: ['hold_meeting', 'record_minutes']
  },
  'meeting_completed': { // 会议完成
    next: ['result_announced'],
    actions: ['announce_result', 'handle_appeals']
  },
  'result_announced': { // 结果公示
    next: ['archived'],
    actions: ['archive', 'generate_certificate']
  },
  'archived': { // 已归档
    next: [],
    actions: ['view', 'export']
  }
}
```

## ⚙️ 技术实现要点

### 1. 权限控制
```javascript
// 验收模块权限配置
const ACCEPTANCE_PERMISSIONS = {
  'acceptance.view': '查看验收信息',
  'acceptance.create': '创建验收申请',
  'acceptance.edit': '编辑验收信息',
  'acceptance.review': '审核验收材料',
  'acceptance.assign': '分配验收专家',
  'acceptance.evaluate': '专家评审',
  'acceptance.announce': '发布验收结果',
  'acceptance.archive': '归档管理'
}
```

### 2. API接口设计
```javascript
// 验收模块API接口
const AcceptanceAPI = {
  // 获取验收列表
  getAcceptanceList: (params) => request.get('/api/acceptance/list', { params }),
  
  // 创建验收申请
  createAcceptance: (data) => request.post('/api/acceptance/create', data),
  
  // 上传验收材料
  uploadMaterial: (projectId, file) => request.post(`/api/acceptance/${projectId}/material`, file),
  
  // 分配专家
  assignExperts: (projectId, expertIds) => request.post(`/api/acceptance/${projectId}/experts`, { expertIds }),
  
  // 提交专家评审
  submitEvaluation: (projectId, evaluation) => request.post(`/api/acceptance/${projectId}/evaluation`, evaluation),
  
  // 安排验收会议
  scheduleMeeting: (projectId, meetingData) => request.post(`/api/acceptance/${projectId}/meeting`, meetingData),
  
  // 发布验收结果
  announceResult: (projectId, result) => request.post(`/api/acceptance/${projectId}/result`, result),
  
  // 归档项目
  archiveProject: (projectId, archiveData) => request.post(`/api/acceptance/${projectId}/archive`, archiveData)
}
```

## 🚀 实施计划

### 第一阶段：基础结构搭建（1天）
- [x] 创建新的文件目录结构
- [x] 更新路由配置
- [x] 修改菜单配置
- [x] 创建基础页面框架

### 第二阶段：核心功能开发（3天）
- [ ] 验收管理中心页面
- [ ] 材料提交功能
- [ ] 专家评审功能
- [ ] 会议管理功能

### 第三阶段：高级功能（2天）
- [ ] 结果公示功能
- [ ] 归档管理功能
- [ ] 报表导出功能
- [ ] 权限控制完善

### 第四阶段：测试优化（1天）
- [ ] 功能测试
- [ ] 性能优化
- [ ] UI优化
- [ ] 文档完善

## 📋 注意事项

### 数据迁移
1. 现有验收数据需要平滑迁移
2. 确保历史数据完整性
3. 提供数据迁移脚本

### 用户体验
1. 菜单调整后需要用户引导
2. 保持操作习惯的连续性
3. 提供帮助文档和操作指南

### 系统集成
1. 与OA系统的集成接口需要调整
2. 与其他模块的数据关联需要更新
3. 确保API接口的向后兼容性

## ✅ 预期效果

1. **功能独立性**：验收功能作为独立模块，职责更清晰
2. **流程专业性**：专门的验收流程管理，更加规范
3. **操作便捷性**：统一的验收管理中心，一站式操作
4. **扩展性更强**：独立模块便于后续功能扩展
5. **维护性提升**：代码结构更清晰，便于维护

这个重构方案将项目结题验收从项目实施模块中完全独立出来，形成一个完整的验收管理体系，提升了系统的专业性和可维护性。 