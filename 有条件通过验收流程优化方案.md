# 有条件通过验收流程优化方案

## 背景说明

在项目验收过程中，存在"有条件通过"的情况。即项目基本达到验收要求，但还需要完成一些指定的整改要求。原先的逻辑是让申请人"确认整改"，但这不够明确。根据实际业务需求，有条件通过的情况下，申请人需要重新提交相关整改材料，但无需再次举行验收会议。

## 优化方案

### 1. 申请人端优化

#### 1.1 操作按钮调整
- **原逻辑**：`有条件通过` 状态显示"确认整改"按钮
- **新逻辑**：`有条件通过` 状态显示"提交整改材料"按钮

#### 1.2 进度文本优化
- **原文本**：`待整改确认`
- **新文本**：`待提交整改材料`

#### 1.3 提交整改材料流程
1. 点击"提交整改材料"按钮
2. 跳转到提交页面，自动填充项目基本信息
3. 自动显示整改要求内容
4. 申请人根据要求上传相关整改材料
5. 提交后等待管理者审核

#### 1.4 提交页面适配
- **页面标题**：根据场景动态显示
  - 普通提交：`提交验收申请`
  - 重新提交：`重新提交验收申请`
  - 整改材料：`提交整改材料`

- **页面描述**：
  - 普通提交：`填写项目验收申请信息并上传相关材料`
  - 重新提交：`根据审核意见修改完善后重新提交验收申请`
  - 整改材料：`根据验收会议的整改要求，提交相应的整改材料和说明`

- **提醒内容**：
  - 重新提交：`由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料`
  - 整改材料：`请根据验收会议的整改要求，上传相应的整改材料和说明文档`

- **显示内容**：
  - 重新提交：显示"审核驳回意见"
  - 整改材料：显示"整改要求"

### 2. 管理者端优化

#### 2.1 操作按钮调整
- **原逻辑**：`有条件通过` 状态显示"确认整改"按钮
- **新逻辑**：`有条件通过` 状态显示"审核整改材料"按钮

#### 2.2 审核整改材料流程
1. 管理者点击"审核整改材料"按钮
2. 弹出确认对话框，询问整改材料是否满足要求
3. 两种选择：
   - **确认通过**：整改材料满足要求，项目状态更新为`验收通过`
   - **需要继续整改**：整改材料不满足要求，保持`有条件通过`状态

### 3. 验收流程说明优化

#### 3.1 申请人端流程说明
- **原说明**：`验收基本通过，需要完成指定整改要求`
- **新说明**：`验收基本通过，需要根据整改要求提交相关材料（无需再次开会）`

#### 3.2 管理者端流程说明
- **原说明**：`项目基本达标，需要完成指定整改要求`
- **新说明**：`项目基本达标，申报单位需提交整改材料（无需再次开会）`

## 技术实现

### 1. 数据传递机制

```javascript
// 整改材料提交跳转
router.push({
  path: '/acceptance/application/submit',
  query: {
    improvement: 'true',                    // 标识整改材料提交
    projectId: record.id,                   // 项目ID
    projectName: encodeURIComponent(record.projectName),
    projectCode: record.projectCode,
    expectedTime: record.expectedTime,
    description: encodeURIComponent(record.description),
    improvementRequirements: encodeURIComponent(improvementRequirements) // 整改要求
  }
})
```

### 2. 页面状态判断

```javascript
// 判断是否是整改材料提交模式
const isImprovement = computed(() => {
  return router.currentRoute.value.query.improvement === 'true'
})

// 动态页面标题
const pageTitle = computed(() => {
  if (isImprovement.value) {
    return '提交整改材料'
  } else if (isResubmit.value) {
    return '重新提交验收申请'
  } else {
    return '提交验收申请'
  }
})
```

### 3. 管理者审核逻辑

```javascript
// 审核整改材料操作
const handleReviewImprovement = (project) => {
  Modal.confirm({
    title: '审核整改材料',
    content: `项目"${project.name}"已提交整改材料，是否确认整改完成并通过验收？`,
    okText: '确认通过',
    cancelText: '需要继续整改',
    onOk() {
      // 整改材料审核通过，更新为验收通过
      updateProjectStatus(project.id, 'acceptance_passed')
    },
    onCancel() {
      // 整改材料不满足要求，保持有条件通过状态
      message.info('请联系申请单位继续完善整改材料')
    }
  })
}
```

## 业务流程图

```
有条件通过验收流程：

1. 验收会议结束 → 录入"有条件通过"结论
2. 申请人收到通知 → 状态变为"有条件通过"
3. 申请人点击"提交整改材料" → 跳转到提交页面
4. 自动填充项目信息 → 显示整改要求
5. 申请人上传整改材料 → 提交整改申请
6. 管理者收到通知 → 审核整改材料
7. 管理者确认通过 → 状态变为"验收通过"
   或
   管理者认为需继续整改 → 保持"有条件通过"状态
```

## 优势分析

1. **流程更清晰**：明确了有条件通过后的具体操作步骤
2. **操作更直观**：按钮文本和页面提示更符合实际业务场景
3. **效率更高**：无需再次组织会议，管理者直接审核整改材料即可
4. **体验更好**：自动填充项目信息，减少用户重复输入
5. **逻辑更完整**：覆盖了整改材料不满足要求的情况处理

## 实施效果

通过本次优化，有条件通过的验收流程更加规范化和自动化，提升了用户体验，减少了操作复杂度，使得验收管理系统的业务逻辑更加完善。