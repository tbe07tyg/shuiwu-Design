import{M as pe,m as g}from"./MaterialTemplateSync-DJgW6a9z.js";import{e as o,I as ge,_ as _e,V as ve,H as fe,G as ye,D as he,O as Ce,C as Oe,W as be,J as we,F as ke,b as S,d as n,j as c,g as l,w as i,a as u,r as Fe,c as xe,o as Te,T as re,k as O,i as h,t as d,v as de,x as Se,f as E,p as B}from"./index-XOIS1SV9.js";import{I as Re}from"./InboxOutlined-B0ILiTZM.js";import{P as Be}from"./PieChartOutlined-37Tu3vQT.js";import{R as Ne}from"./RocketOutlined-2IJnOtVR.js";import{U as Ie}from"./UploadOutlined-BeZhUyI8.js";var De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"}}]},name:"form",theme:"outlined"};function ce(r){for(var t=1;t<arguments.length;t++){var p=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(p);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(p).filter(function(C){return Object.getOwnPropertyDescriptor(p,C).enumerable}))),e.forEach(function(C){Pe(r,C,p[C])})}return r}function Pe(r,t,p){return t in r?Object.defineProperty(r,t,{value:p,enumerable:!0,configurable:!0,writable:!0}):r[t]=p,r}var se=function(t,p){var e=ce({},t,p.attrs);return o(ge,ce({},e,{icon:De}),null)};se.displayName="FormOutlined";se.inheritAttrs=!1;const Ue={name:"MaterialTemplateManager",components:{FileTextOutlined:ke,UploadOutlined:Ie,DownloadOutlined:we,ReloadOutlined:be,FormOutlined:se,RocketOutlined:Ne,PieChartOutlined:Be,CheckCircleOutlined:Oe,PlusOutlined:Ce,EditOutlined:he,DeleteOutlined:ye,FileOutlined:fe,EyeOutlined:ve,InboxOutlined:Re,MaterialTemplateSync:pe},setup(){const r=u("apply"),t=u(!1),p=u(!1),e=u(!1),C=u(!1),F=u(""),x=u(!1),N=u(!1),m=u(!1),I=u("apply"),z={apply:"立项申请",opening:"项目开题",midterm:"项目中期",acceptance:"项目验收"},v=Fe({id:null,categoryName:"",isRequired:!0,sortOrder:1,description:"",templateFileName:"",templateFilePath:""}),f=u([]),b=u([]),D=u(!1),P=u(!1),j={categoryName:[{required:!0,message:"请输入类目名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入显示顺序",trigger:"blur"}]},M=[{title:"序号",dataIndex:"sortOrder",key:"sortOrder",width:80,align:"center",sorter:(a,_)=>a.sortOrder-_.sortOrder},{title:"类目名称",dataIndex:"categoryName",key:"categoryName",width:200},{title:"必传项",dataIndex:"isRequired",key:"isRequired",width:100,align:"center"},{title:"模板文件",dataIndex:"templateFileName",key:"templateFileName",width:250},{title:"描述说明",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:180,align:"center"}],J={pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,_)=>`共 ${a} 条记录，当前显示 ${_[0]}-${_[1]} 条`},K=xe(()=>C.value?"编辑资料类目":"添加资料类目"),A=a=>g.getConfigsByBusinessType(a).length,H=a=>g.getConfigsByBusinessType(a).filter(y=>y.isRequired).length,W=a=>g.getConfigsByBusinessType(a).filter(y=>!y.isRequired).length,G=a=>{const _=g.getConfigsByBusinessType(a);return F.value?_.filter(y=>y.categoryName.toLowerCase().includes(F.value.toLowerCase())||y.description&&y.description.toLowerCase().includes(F.value.toLowerCase())).sort((y,ie)=>(y.sortOrder||0)-(ie.sortOrder||0)):_.sort((y,ie)=>(y.sortOrder||0)-(ie.sortOrder||0))},Q=async()=>{x.value=!0;try{await g.initConfigs(),O.success("配置刷新成功")}catch{O.error("配置刷新失败")}finally{x.value=!1}},X=a=>{r.value=a},Y=a=>{r.value=a,F.value=""},Z=a=>{F.value=a},T=()=>{C.value=!1,R(),t.value=!0},q=a=>{C.value=!0,Object.assign(v,a),a.templateFileName?f.value=[{uid:"1",name:a.templateFileName,status:"done"}]:f.value=[],t.value=!0},$=async a=>{re.confirm({title:"确认删除",content:`确定要删除类目"${a.categoryName}"吗？删除后将无法恢复，请谨慎操作！`,okText:"确定删除",cancelText:"取消",okType:"danger",async onOk(){try{await g.deleteConfig(r.value,a.id)}catch{}}})},ee=async()=>{N.value=!0;try{const a={...v};C.value?await g.updateConfig(r.value,a.id,a):await g.addConfig(r.value,a),t.value=!1,R()}catch{}finally{N.value=!1}},R=()=>{const a=g.getConfigsByBusinessType(r.value);Object.assign(v,{id:null,categoryName:"",isRequired:!0,sortOrder:a.length+1,description:"",templateFileName:"",templateFilePath:""}),f.value=[]},te=()=>{R()},ae=a=>a.size>10485760?(O.error("文件大小不能超过10MB"),!1):(D.value=!0,setTimeout(()=>{v.templateFileName=a.name,v.templateFilePath=`/templates/${r.value}/${a.name}`,f.value=[{uid:a.uid||Date.now().toString(),name:a.name,status:"done",url:v.templateFilePath,originFileObj:a}],D.value=!1,O.success(`模板文件 "${a.name}" 已选择`)},200),!1),U=a=>(v.templateFileName="",v.templateFilePath="",f.value=[],O.success("模板文件已移除"),!0),oe=a=>{O.info(`正在下载模板：${a.templateFileName}`)},ne=a=>{I.value=a,p.value=!0},le=a=>{console.log("预览页面配置已更新",a)},s=()=>{e.value=!0},L=()=>{b.value=[]},k=a=>a.name.endsWith(".json")?(P.value=!0,setTimeout(()=>{b.value=[{uid:a.uid||Date.now().toString(),name:a.name,status:"done",originFileObj:a}],P.value=!1,O.success(`配置文件 "${a.name}" 已选择`)},200),!1):(O.error("请选择JSON格式的配置文件"),!1),w=a=>(b.value=[],O.success("导入文件已移除"),!0),V=async()=>{if(b.value.length===0){O.warning("请先选择要导入的配置文件");return}m.value=!0;try{const a=b.value[0].originFileObj;await g.importConfigs(a,r.value),e.value=!1,b.value=[]}catch{}finally{m.value=!1}},me=()=>{g.exportConfigs(r.value)},ue=()=>{re.confirm({title:"确认重置",content:"确定要重置为默认配置吗？当前所有自定义配置将被清空，此操作无法撤销！",okText:"确定重置",cancelText:"取消",okType:"danger",async onOk(){await g.resetToDefault(r.value)}})};return Te(async()=>{x.value=!0;try{await g.initConfigs()}finally{x.value=!1}}),{activeTab:r,dialogVisible:t,previewVisible:p,importVisible:e,categoryForm:v,categoryRules:j,searchKeyword:F,columns:M,loading:x,submitLoading:N,importLoading:m,businessTabs:z,templateFileList:f,importFileList:b,templateUploading:D,importUploading:P,paginationConfig:J,previewBusinessType:I,dialogTitle:K,getBusinessStats:A,getRequiredStats:H,getOptionalStats:W,getFilteredConfigs:G,handleRefreshConfigs:Q,handleStatCardClick:X,handleTabChange:Y,handleSearch:Z,handleAddCategory:T,handleEditCategory:q,handleDeleteCategory:$,handleSaveCategory:ee,handleDialogClose:te,resetCategoryForm:R,handleTemplateUpload:ae,handleRemoveTemplate:U,handleDownloadTemplate:oe,handlePreviewBusinessPage:ne,handlePreviewConfigUpdate:le,handleBatchImport:s,handleImportDialogClose:L,handleImportFile:k,handleRemoveImportFile:w,handleConfirmImport:V,handleBatchExport:me,handleResetToDefault:ue}}},Le={class:"material-template-manager"},qe={class:"page-header"},Ve={class:"header-content"},Ee={class:"page-title"},ze={class:"title-icon"},je={class:"header-actions"},Me={class:"stats-overview"},Je={class:"stat-icon"},Ke={class:"stat-content"},Ae={class:"stat-number"},He={class:"stat-detail"},We={class:"stat-icon"},Ge={class:"stat-content"},Qe={class:"stat-number"},Xe={class:"stat-detail"},Ye={class:"stat-icon"},Ze={class:"stat-content"},$e={class:"stat-number"},et={class:"stat-detail"},tt={class:"stat-icon"},at={class:"stat-content"},ot={class:"stat-number"},nt={class:"stat-detail"},lt={class:"content-card"},it={class:"tab-content"},st={class:"toolbar"},rt={class:"toolbar-left"},dt={class:"toolbar-right"},ct={key:0,class:"template-file"},mt={key:1,class:"no-template"},ut={key:2,class:"action-buttons"},pt={class:"upload-tips"},gt={key:0,class:"upload-success"},_t={class:"ant-upload-drag-icon"},vt={class:"ant-upload-text"},ft={class:"ant-upload-hint"};function yt(r,t,p,e,C,F){const x=l("FileTextOutlined"),N=l("ReloadOutlined"),m=l("a-button"),I=l("UploadOutlined"),z=l("DownloadOutlined"),v=l("FormOutlined"),f=l("a-col"),b=l("RocketOutlined"),D=l("PieChartOutlined"),P=l("CheckCircleOutlined"),j=l("a-row"),M=l("PlusOutlined"),J=l("EyeOutlined"),K=l("a-input-search"),A=l("a-tag"),H=l("FileOutlined"),W=l("EditOutlined"),G=l("DeleteOutlined"),Q=l("a-table"),X=l("a-tab-pane"),Y=l("a-tabs"),Z=l("a-input"),T=l("a-form-item"),q=l("a-radio"),$=l("a-radio-group"),ee=l("a-input-number"),R=l("a-upload"),te=l("a-textarea"),ae=l("a-form"),U=l("a-modal"),oe=l("MaterialTemplateSync"),ne=l("InboxOutlined"),le=l("a-upload-dragger");return h(),S("div",Le,[n("div",qe,[n("div",Ve,[n("h1",Ee,[n("span",ze,[o(x)]),t[13]||(t[13]=c(" 材料提交模板维护 "))]),t[14]||(t[14]=n("p",{class:"page-description"}," 统一管理各业务环节的资料类目和模板文件，实现配置的集中维护和实时同步 ",-1))]),n("div",je,[o(m,{onClick:e.handleRefreshConfigs,loading:e.loading},{default:i(()=>[o(N),t[15]||(t[15]=c(" 刷新配置 "))]),_:1,__:[15]},8,["onClick","loading"]),o(m,{type:"primary",onClick:e.handleBatchImport},{default:i(()=>[o(I),t[16]||(t[16]=c(" 批量导入 "))]),_:1,__:[16]},8,["onClick"]),o(m,{onClick:e.handleBatchExport},{default:i(()=>[o(z),t[17]||(t[17]=c(" 批量导出 "))]),_:1,__:[17]},8,["onClick"]),o(m,{type:"primary",danger:"",onClick:e.handleResetToDefault},{default:i(()=>t[18]||(t[18]=[c(" 重置默认 ")])),_:1,__:[18]},8,["onClick"])])]),n("div",Me,[o(j,{gutter:16},{default:i(()=>[o(f,{xs:12,sm:8,md:6,lg:6,xl:6},{default:i(()=>[n("div",{class:"stat-card pending",onClick:t[0]||(t[0]=s=>e.handleStatCardClick("apply"))},[n("div",Je,[o(v)]),n("div",Ke,[n("div",Ae,d(e.getBusinessStats("apply")),1),t[19]||(t[19]=n("div",{class:"stat-label"},"立项申请类目",-1)),n("div",He,"必传"+d(e.getRequiredStats("apply"))+" | 选传"+d(e.getOptionalStats("apply")),1)])])]),_:1}),o(f,{xs:12,sm:8,md:6,lg:6,xl:6},{default:i(()=>[n("div",{class:"stat-card reviewing",onClick:t[1]||(t[1]=s=>e.handleStatCardClick("opening"))},[n("div",We,[o(b)]),n("div",Ge,[n("div",Qe,d(e.getBusinessStats("opening")),1),t[20]||(t[20]=n("div",{class:"stat-label"},"项目开题类目",-1)),n("div",Xe,"必传"+d(e.getRequiredStats("opening"))+" | 选传"+d(e.getOptionalStats("opening")),1)])])]),_:1}),o(f,{xs:12,sm:8,md:6,lg:6,xl:6},{default:i(()=>[n("div",{class:"stat-card scheduled",onClick:t[2]||(t[2]=s=>e.handleStatCardClick("midterm"))},[n("div",Ye,[o(D)]),n("div",Ze,[n("div",$e,d(e.getBusinessStats("midterm")),1),t[21]||(t[21]=n("div",{class:"stat-label"},"项目中期类目",-1)),n("div",et,"必传"+d(e.getRequiredStats("midterm"))+" | 选传"+d(e.getOptionalStats("midterm")),1)])])]),_:1}),o(f,{xs:12,sm:8,md:6,lg:6,xl:6},{default:i(()=>[n("div",{class:"stat-card completed",onClick:t[3]||(t[3]=s=>e.handleStatCardClick("acceptance"))},[n("div",tt,[o(P)]),n("div",at,[n("div",ot,d(e.getBusinessStats("acceptance")),1),t[22]||(t[22]=n("div",{class:"stat-label"},"项目验收类目",-1)),n("div",nt,"必传"+d(e.getRequiredStats("acceptance"))+" | 选传"+d(e.getOptionalStats("acceptance")),1)])])]),_:1})]),_:1})]),n("div",lt,[o(Y,{activeKey:e.activeTab,"onUpdate:activeKey":t[5]||(t[5]=s=>e.activeTab=s),onChange:e.handleTabChange,class:"custom-tabs",type:"card"},{default:i(()=>[(h(!0),S(de,null,Se(e.businessTabs,(s,L)=>(h(),E(X,{key:L,tab:s},{default:i(()=>[n("div",it,[n("div",st,[n("div",rt,[o(m,{type:"primary",onClick:e.handleAddCategory},{default:i(()=>[o(M),t[23]||(t[23]=c(" 添加新类目 "))]),_:1,__:[23]},8,["onClick"]),o(m,{onClick:k=>e.handlePreviewBusinessPage(L)},{default:i(()=>[o(J),t[24]||(t[24]=c(" 预览效果 "))]),_:2,__:[24]},1032,["onClick"])]),n("div",dt,[o(K,{value:e.searchKeyword,"onUpdate:value":t[4]||(t[4]=k=>e.searchKeyword=k),placeholder:"搜索类目名称",style:{width:"200px"},onSearch:e.handleSearch},null,8,["value","onSearch"])])]),o(Q,{columns:e.columns,"data-source":e.getFilteredConfigs(L),pagination:e.paginationConfig,"row-key":"id",size:"middle",loading:e.loading},{bodyCell:i(({column:k,record:w})=>[k.key==="isRequired"?(h(),E(A,{key:0,color:w.isRequired?"red":"blue",size:"small"},{default:i(()=>[c(d(w.isRequired?"必传":"选传"),1)]),_:2},1032,["color"])):B("",!0),k.key==="templateFileName"?(h(),S(de,{key:1},[w.templateFileName?(h(),S("div",ct,[o(H),n("span",null,d(w.templateFileName),1),o(m,{type:"link",size:"small",onClick:V=>e.handleDownloadTemplate(w)},{default:i(()=>t[25]||(t[25]=[c(" 下载 ")])),_:2,__:[25]},1032,["onClick"])])):(h(),S("span",mt,"暂无模板"))],64)):B("",!0),k.key==="action"?(h(),S("div",ut,[o(m,{type:"primary",size:"small",onClick:V=>e.handleEditCategory(w)},{default:i(()=>[o(W),t[26]||(t[26]=c(" 编辑 "))]),_:2,__:[26]},1032,["onClick"]),o(m,{danger:"",size:"small",onClick:V=>e.handleDeleteCategory(w)},{default:i(()=>[o(G),t[27]||(t[27]=c(" 删除 "))]),_:2,__:[27]},1032,["onClick"])])):B("",!0)]),_:2},1032,["columns","data-source","pagination","loading"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),o(U,{open:e.dialogVisible,"onUpdate:open":t[10]||(t[10]=s=>e.dialogVisible=s),title:e.dialogTitle,width:"700px",onCancel:e.handleDialogClose,onOk:e.handleSaveCategory,"confirm-loading":e.submitLoading},{default:i(()=>[o(ae,{ref:"categoryFormRef",model:e.categoryForm,rules:e.categoryRules,"label-col":{span:6},"wrapper-col":{span:18}},{default:i(()=>[o(T,{label:"类目名称",name:"categoryName"},{default:i(()=>[o(Z,{value:e.categoryForm.categoryName,"onUpdate:value":t[6]||(t[6]=s=>e.categoryForm.categoryName=s),placeholder:"请输入类目名称，如：项目申请书","allow-clear":""},null,8,["value"])]),_:1}),o(T,{label:"是否必传",name:"isRequired"},{default:i(()=>[o($,{value:e.categoryForm.isRequired,"onUpdate:value":t[7]||(t[7]=s=>e.categoryForm.isRequired=s)},{default:i(()=>[o(q,{value:!0},{default:i(()=>t[28]||(t[28]=[c("必传")])),_:1,__:[28]}),o(q,{value:!1},{default:i(()=>t[29]||(t[29]=[c("选传")])),_:1,__:[29]})]),_:1},8,["value"])]),_:1}),o(T,{label:"显示顺序",name:"sortOrder"},{default:i(()=>[o(ee,{value:e.categoryForm.sortOrder,"onUpdate:value":t[8]||(t[8]=s=>e.categoryForm.sortOrder=s),min:1,max:100,style:{width:"100%"},placeholder:"数字越小排序越靠前"},null,8,["value"])]),_:1}),o(T,{label:"模板文件"},{default:i(()=>[o(R,{"file-list":e.templateFileList,"before-upload":e.handleTemplateUpload,remove:e.handleRemoveTemplate,accept:".doc,.docx,.pdf,.xls,.xlsx","max-count":1,"show-upload-list":{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!0}},{default:i(()=>[o(m,{loading:e.templateUploading},{default:i(()=>[e.templateUploading?B("",!0):(h(),E(I,{key:0})),c(" "+d(e.templateUploading?"处理中...":e.templateFileList.length>0?"重新选择":"选择模板文件"),1)]),_:1},8,["loading"])]),_:1},8,["file-list","before-upload","remove"]),n("div",pt,[t[30]||(t[30]=c(" 支持 Word、Excel、PDF 格式，文件大小不超过10MB ")),e.templateFileList.length>0?(h(),S("span",gt," ✓ 文件已选择："+d(e.templateFileList[0].name),1)):B("",!0)])]),_:1}),o(T,{label:"描述说明"},{default:i(()=>[o(te,{value:e.categoryForm.description,"onUpdate:value":t[9]||(t[9]=s=>e.categoryForm.description=s),rows:4,placeholder:"请输入对该类目的详细说明，用于帮助用户理解该材料的用途和要求...",maxlength:500,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title","onCancel","onOk","confirm-loading"]),o(U,{open:e.previewVisible,"onUpdate:open":t[11]||(t[11]=s=>e.previewVisible=s),title:`${e.businessTabs[e.previewBusinessType]}页面预览`,width:"90%",style:{top:"20px"},footer:null},{default:i(()=>[e.previewVisible?(h(),E(oe,{key:0,"business-type":e.previewBusinessType,"auto-load":!0,onConfigUpdate:e.handlePreviewConfigUpdate},null,8,["business-type","onConfigUpdate"])):B("",!0)]),_:1},8,["open","title"]),o(U,{open:e.importVisible,"onUpdate:open":t[12]||(t[12]=s=>e.importVisible=s),title:"批量导入配置",onOk:e.handleConfirmImport,onCancel:e.handleImportDialogClose,"confirm-loading":e.importLoading},{default:i(()=>[o(le,{"file-list":e.importFileList,"before-upload":e.handleImportFile,remove:e.handleRemoveImportFile,accept:".json","max-count":1,"show-upload-list":{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!0}},{default:i(()=>[n("p",_t,[o(ne)]),n("p",vt,d(e.importFileList.length>0?"重新选择文件":"点击或拖拽文件到此区域上传"),1),n("p",ft,d(e.importFileList.length>0?`已选择：${e.importFileList[0].name}`:"支持导入JSON格式的配置文件"),1)]),_:1},8,["file-list","before-upload","remove"])]),_:1},8,["open","onOk","onCancel","confirm-loading"])])}const Ft=_e(Ue,[["render",yt],["__scopeId","data-v-3612044a"]]);export{Ft as default};
