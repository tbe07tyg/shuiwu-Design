import{_ as we,a as p,c as M,o as Ce,u as be,b as d,d as s,p as k,f as D,e as l,w as n,g as u,i as o,v as N,x as Y,t as i,j as g,n as $,z as je,m as v,q as G,B as xe,F as Me,P as Ne,J as Oe,Y as Pe,E as Te,C as ze,k as C,s as R}from"./index-XOIS1SV9.js";import{B as Ue}from"./BellOutlined-DbWFvKqD.js";import{A as qe}from"./AlertOutlined-DgzVrtb7.js";const $e={class:"progress-container"},Re={class:"action-bar"},Se={class:"project-option"},Ye={class:"project-name"},Be={class:"project-info"},Fe={key:0,class:"content-area"},Ve={class:"project-header"},Ae={class:"project-basic"},Ie={class:"project-stats"},Le={class:"stat-item"},Ee={class:"stat-value"},Xe={class:"stat-item"},Qe={class:"stat-value"},Je={class:"stat-item"},Ge={class:"stat-value"},He={class:"progress-overview"},Ke={class:"progress-header"},We={class:"progress-stats"},Ze={class:"progress-text"},et={class:"progress-detail"},tt={class:"progress-milestones"},st={class:"milestone-info"},at={class:"milestone-name"},lt={class:"milestone-date"},nt={class:"timeline-container"},ot={class:"timeline-wrapper"},it={class:"timeline-content"},dt={class:"node-header"},rt={class:"node-time"},ut={key:0},ct={key:1},pt={key:2},mt={class:"node-desc"},vt={key:0,class:"materials-section"},_t={class:"materials-header"},ft={key:0,class:"materials-list"},gt={class:"material-info"},yt={class:"material-name"},ht={class:"material-actions"},kt={key:1,class:"no-materials"},Dt={class:"node-actions"},wt={class:"timeline-item approval-node"},Ct={class:"timeline-dot completed"},bt={class:"timeline-content"},jt={class:"node-time"},xt={__name:"index",setup(Mt){const _=p(""),B=p({}),F=p({}),O=p(!1),V=p(null),y=p({scheduledDate:null,remark:""}),P=p(!1),T=p(null),H=p(null),b=p({reason:""}),w=p([{id:"P001",name:"XXX科研项目",leader:"张教授",type:"国家自然科学基金",status:"实施中",startDate:"2024-01-01",approvalDate:"2024-01-15"},{id:"P002",name:"YYY技术研发",leader:"李博士",type:"省级科技计划",status:"实施中",startDate:"2024-02-01",approvalDate:"2024-02-10"}]),f=M(()=>w.value.find(t=>t.id===_.value)),m=p([]),K=M(()=>[...m.value].reverse()),A=M(()=>m.value.length+1),E=M(()=>m.value.filter(e=>e.status==="completed").length+1),I=M(()=>A.value===0?0:Math.round(E.value/A.value*100)),W=M(()=>{var t,e,z,h,j,S;return f.value?[{name:"立项",date:f.value.approvalDate,status:"completed"},{name:"开题",date:(t=m.value.find(r=>r.id==="opening-meeting"))==null?void 0:t.scheduledDate,status:((e=m.value.find(r=>r.id==="opening-meeting"))==null?void 0:e.status)||"waiting"},{name:"中期",date:(z=m.value.find(r=>r.id==="midterm-meeting"))==null?void 0:z.scheduledDate,status:((h=m.value.find(r=>r.id==="midterm-meeting"))==null?void 0:h.status)||"waiting"},{name:"验收",date:(j=m.value.find(r=>r.id==="acceptance-meeting"))==null?void 0:j.scheduledDate,status:((S=m.value.find(r=>r.id==="acceptance-meeting"))==null?void 0:S.status)||"waiting"}]:[]}),Z=t=>{const e={P001:[{id:"opening-submit",name:"项目开题 - 资料提交",type:"submission",status:"completed",scheduledDate:"2024-02-15",completedDate:"2024-02-12",description:"提交开题报告、研究方案等相关材料",materials:[{id:"m1",name:"开题报告.pdf",status:"approved"},{id:"m2",name:"研究方案.docx",status:"approved"}]},{id:"opening-meeting",name:"项目开题 - 报告会",type:"meeting",status:"completed",scheduledDate:"2024-02-20",completedDate:"2024-02-20",description:"参加开题报告会，专家评审"},{id:"midterm-submit",name:"项目中期 - 资料提交",type:"submission",status:"in-progress",scheduledDate:"2024-06-15",description:"提交中期检查报告、阶段性成果等材料",materials:[{id:"m3",name:"中期报告.pdf",status:"submitted"},{id:"m4",name:"阶段成果.docx",status:"pending"}]},{id:"midterm-meeting",name:"项目中期 - 报告会",type:"meeting",status:"waiting",description:"参加中期检查报告会"},{id:"acceptance-submit",name:"项目验收 - 资料提交",type:"submission",status:"waiting",description:"提交验收报告、最终成果等材料"},{id:"acceptance-meeting",name:"项目验收 - 报告会",type:"meeting",status:"waiting",description:"参加项目验收报告会"}],P002:[{id:"opening-submit",name:"项目开题 - 资料提交",type:"submission",status:"overdue",scheduledDate:"2024-03-01",description:"提交开题报告、技术方案等相关材料",materials:[{id:"m1",name:"开题报告.pdf",status:"rejected"}]},{id:"opening-meeting",name:"项目开题 - 报告会",type:"meeting",status:"waiting",description:"参加开题报告会，专家评审"}]};m.value=e[t]||[]},L=t=>{Z(t)},ee=t=>({"completed-node":t.status==="completed","in-progress-node":t.status==="in-progress","overdue-node":t.status==="overdue","waiting-node":t.status==="waiting"}),te=t=>({completed:t.status==="completed","in-progress":t.status==="in-progress",overdue:t.status==="overdue",waiting:t.status==="waiting"}),se=t=>{switch(t.status){case"completed":return"CheckCircleOutlined";case"in-progress":return"PlayCircleOutlined";case"overdue":return"AlertOutlined";default:return"MinusCircleOutlined"}},ae=t=>({completed:"已完成","in-progress":"进行中",overdue:"已超期",waiting:"等待中"})[t]||"未知",le=t=>({pending:"orange",submitted:"blue",approved:"green",rejected:"red"})[t]||"default",ne=t=>({pending:"待提交",submitted:"已提交",approved:"已通过",rejected:"已打回"})[t]||"未知",oe=t=>{if(!t.scheduledDate||t.status==="completed")return!1;const e=R(t.scheduledDate).diff(R(),"day");return e<=3&&e>0},ie=t=>!t.scheduledDate||t.status==="completed"?!1:t.status==="overdue"||R().isAfter(R(t.scheduledDate)),de=async t=>{B.value[t.id]=!0;try{await new Promise(e=>setTimeout(e,1e3)),C.success(`已向相关人员发送${t.name}的提醒通知`)}finally{B.value[t.id]=!1}},re=async t=>{F.value[t.id]=!0;try{await new Promise(e=>setTimeout(e,1e3)),C.success(`已向相关人员发送${t.name}的催办通知`)}finally{F.value[t.id]=!1}},ue=t=>{V.value=t,y.value={scheduledDate:null,remark:""},O.value=!0},ce=()=>{if(!y.value.scheduledDate){C.error("请选择截止时间");return}const t=m.value.find(e=>e.id===V.value.id);t&&(t.scheduledDate=y.value.scheduledDate.format("YYYY-MM-DD"),t.status="in-progress",C.success("节点时间设置成功")),O.value=!1},pe=()=>{O.value=!1},me=t=>t&&t<R().startOf("day"),ve=t=>{C.info(`下载材料：${t.name}`)},_e=(t,e)=>{T.value=t,H.value=e,b.value={reason:""},P.value=!0},fe=()=>{if(!b.value.reason.trim()){C.error("请填写打回原因");return}T.value&&(T.value.status="rejected",T.value.rejectReason=b.value.reason),C.success("材料已打回，相关人员将收到通知"),P.value=!1},ge=()=>{P.value=!1};return Ce(()=>{const t=be(),e=t.query.projectId;if(e){if(w.value.find(h=>h.id===e))_.value=e;else{const h={id:e,name:t.query.projectName||"Unknown Project",leader:t.query.applicant||"Unknown",type:t.query.projectType||"Unknown Type",status:"实施中",startDate:t.query.startDate||"2024-01-01",approvalDate:t.query.approvalDate||"2024-01-01"};w.value.unshift(h),_.value=e}L(_.value)}else w.value.length>0&&(_.value=w.value[0].id,L(_.value))}),(t,e)=>{const z=u("a-select-option"),h=u("a-select"),j=u("a-tag"),S=u("a-space"),r=u("a-card"),ye=u("a-progress"),x=u("a-button"),he=u("a-empty"),U=u("a-form-item"),ke=u("a-date-picker"),X=u("a-textarea"),Q=u("a-form"),J=u("a-modal");return o(),d("div",$e,[e[22]||(e[22]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"进度监控"),s("div",{class:"page-desc"},"基于时间维度监控项目实施进度，实时跟踪节点状态与材料提交")],-1)),s("div",Re,[l(h,{value:_.value,"onUpdate:value":e[0]||(e[0]=a=>_.value=a),placeholder:"选择项目进行监控",style:{width:"280px"},onChange:L,size:"large"},{default:n(()=>[(o(!0),d(N,null,Y(w.value,a=>(o(),D(z,{key:a.id,value:a.id},{default:n(()=>[s("div",Se,[s("div",Ye,i(a.name),1),s("div",Be,i(a.leader)+" · "+i(a.startDate),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),f.value?(o(),d("div",Fe,[l(r,{class:"project-info-card",size:"small"},{default:n(()=>[s("div",Ve,[s("div",Ae,[s("h3",null,i(f.value.name),1),l(S,null,{default:n(()=>[l(j,{color:"blue"},{default:n(()=>[g(i(f.value.type),1)]),_:1}),l(j,{color:"green"},{default:n(()=>[g(i(f.value.status),1)]),_:1})]),_:1})]),s("div",Ie,[s("div",Le,[e[7]||(e[7]=s("div",{class:"stat-label"},"项目负责人",-1)),s("div",Ee,i(f.value.leader),1)]),s("div",Xe,[e[8]||(e[8]=s("div",{class:"stat-label"},"立项时间",-1)),s("div",Qe,i(f.value.approvalDate),1)]),s("div",Je,[e[9]||(e[9]=s("div",{class:"stat-label"},"整体进度",-1)),s("div",Ge,i(I.value)+"%",1)])])])]),_:1}),l(r,{class:"progress-overview-card",size:"small"},{default:n(()=>[s("div",He,[s("div",Ke,[e[10]||(e[10]=s("h4",null,"项目整体进度",-1)),s("div",We,[s("span",Ze,i(I.value)+"% 完成",1),s("span",et,i(E.value)+"/"+i(A.value)+" 节点",1)])]),l(ye,{percent:I.value,"stroke-color":{"0%":"#108ee9","100%":"#87d068"},"trail-color":"#f0f0f0","stroke-width":"8","show-info":!1},null,8,["percent"]),s("div",tt,[(o(!0),d(N,null,Y(W.value,(a,q)=>(o(),d("div",{class:"milestone-item",key:q},[s("div",{class:$(["milestone-dot",a.status])},null,2),s("div",st,[s("div",at,i(a.name),1),s("div",lt,i(a.date||"待定"),1)])]))),128))])])]),_:1}),l(r,{class:"timeline-card",title:"项目实施进度时间轴"},{default:n(()=>[s("div",nt,[s("div",ot,[(o(!0),d(N,null,Y(K.value,(a,q)=>(o(),d("div",{key:a.id,class:$(["timeline-item",ee(a)])},[s("div",{class:$(["timeline-dot",te(a)])},[(o(),D(je(se(a))))],2),s("div",it,[s("div",dt,[s("h4",null,i(a.name),1),s("div",{class:$(["node-status",a.status])},i(ae(a.status)),3)]),s("div",rt,[a.scheduledDate?(o(),d(N,{key:0},[l(v(G)),a.status==="completed"?(o(),d("span",ut,"完成时间："+i(a.completedDate),1)):a.status==="overdue"?(o(),d("span",ct,"截止时间："+i(a.scheduledDate)+" (已超期)",1)):(o(),d("span",pt,"截止时间："+i(a.scheduledDate),1))],64)):(o(),d(N,{key:1},[l(v(xe)),e[11]||(e[11]=s("span",{class:"pending-time"},"等待确定时间",-1))],64))]),s("div",mt,i(a.description),1),a.type==="submission"?(o(),d("div",vt,[s("div",_t,[l(v(Me)),e[12]||(e[12]=s("span",null,"提交材料",-1))]),a.materials&&a.materials.length?(o(),d("div",ft,[(o(!0),d(N,null,Y(a.materials,c=>(o(),d("div",{key:c.id,class:$(["material-item",c.status])},[s("div",gt,[l(v(Ne)),s("span",yt,i(c.name),1),l(j,{color:le(c.status),size:"small"},{default:n(()=>[g(i(ne(c.status)),1)]),_:2},1032,["color"])]),s("div",ht,[c.status!=="pending"?(o(),D(x,{key:0,type:"link",size:"small",onClick:De=>ve(c)},{default:n(()=>[l(v(Oe)),e[13]||(e[13]=g(" 下载 "))]),_:2,__:[13]},1032,["onClick"])):k("",!0),c.status==="submitted"?(o(),D(x,{key:1,type:"link",size:"small",danger:"",onClick:De=>_e(c,a)},{default:n(()=>[l(v(Pe)),e[14]||(e[14]=g(" 打回 "))]),_:2,__:[14]},1032,["onClick"])):k("",!0)])],2))),128))])):(o(),d("div",kt,[l(v(Te)),e[15]||(e[15]=s("span",null,"暂无材料提交",-1))]))])):k("",!0),s("div",Dt,[oe(a)?(o(),D(x,{key:0,type:"primary",size:"small",onClick:c=>de(a),loading:B.value[a.id]},{default:n(()=>[l(v(Ue)),e[16]||(e[16]=g(" 提醒 "))]),_:2,__:[16]},1032,["onClick","loading"])):k("",!0),ie(a)?(o(),D(x,{key:1,type:"primary",danger:"",size:"small",onClick:c=>re(a),loading:F.value[a.id]},{default:n(()=>[l(v(qe)),e[17]||(e[17]=g(" 催办 "))]),_:2,__:[17]},1032,["onClick","loading"])):k("",!0),!a.scheduledDate&&a.status==="waiting"?(o(),D(x,{key:2,type:"default",size:"small",onClick:c=>ue(a)},{default:n(()=>[l(v(G)),e[18]||(e[18]=g(" 设置时间 "))]),_:2,__:[18]},1032,["onClick"])):k("",!0)])])],2))),128)),s("div",wt,[s("div",Ct,[l(v(ze))]),s("div",bt,[e[19]||(e[19]=s("div",{class:"node-header"},[s("h4",null,"项目立项"),s("div",{class:"node-status completed"},"已完成")],-1)),s("div",jt,i(f.value.approvalDate),1),e[20]||(e[20]=s("div",{class:"node-desc"},"项目立项审批通过，正式启动",-1))])])])])]),_:1})])):k("",!0),_.value?k("",!0):(o(),D(he,{key:1,description:"请选择项目查看进度监控"},{default:n(()=>[l(x,{type:"primary",onClick:e[1]||(e[1]=a=>{var q;return _.value=(q=w.value[0])==null?void 0:q.id})},{default:n(()=>e[21]||(e[21]=[g(" 选择项目 ")])),_:1,__:[21]})]),_:1})),l(J,{open:O.value,"onUpdate:open":e[4]||(e[4]=a=>O.value=a),title:"设置节点时间",onOk:ce,onCancel:pe},{default:n(()=>[l(Q,{model:y.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[l(U,{label:"节点名称"},{default:n(()=>{var a;return[s("span",null,i((a=V.value)==null?void 0:a.name),1)]}),_:1}),l(U,{label:"截止时间",required:""},{default:n(()=>[l(ke,{value:y.value.scheduledDate,"onUpdate:value":e[2]||(e[2]=a=>y.value.scheduledDate=a),style:{width:"100%"},"disabled-date":me},null,8,["value"])]),_:1}),l(U,{label:"备注"},{default:n(()=>[l(X,{value:y.value.remark,"onUpdate:value":e[3]||(e[3]=a=>y.value.remark=a),rows:3,placeholder:"可选择添加时间设置说明"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),l(J,{open:P.value,"onUpdate:open":e[6]||(e[6]=a=>P.value=a),title:"材料打回",onOk:fe,onCancel:ge},{default:n(()=>[l(Q,{model:b.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[l(U,{label:"材料名称"},{default:n(()=>{var a;return[s("span",null,i((a=T.value)==null?void 0:a.name),1)]}),_:1}),l(U,{label:"打回原因",required:""},{default:n(()=>[l(X,{value:b.value.reason,"onUpdate:value":e[5]||(e[5]=a=>b.value.reason=a),rows:4,placeholder:"请详细说明材料不合格的原因"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},Tt=we(xt,[["__scopeId","data-v-50633f9a"]]);export{Tt as default};
