import{_ as Z,a as m,c as h,h as ee,o as te,s as C,k as c,b as R,d as i,e,t as y,w as s,g as u,i as U,j as v,m as q,U as ae,p as I,F as se,E as ne}from"./index-XOIS1SV9.js";/* empty css                                                                    */import{M as re}from"./MaterialTemplateSync-DJgW6a9z.js";import{S as le}from"./SaveOutlined-B5HJe_0O.js";import{S as oe}from"./SendOutlined-CSHeOdSH.js";import"./UploadOutlined-BeZhUyI8.js";const ie={class:"submit-container"},ue={class:"page-header"},de={class:"header-content"},me={class:"page-title"},pe={class:"page-description"},ce={class:"header-actions"},ve={class:"form-section"},fe={class:"section-header"},_e={class:"section-content"},ge={key:0,class:"form-section"},ye={class:"section-header"},qe={class:"review-comments-content"},be={class:"comments-text"},xe={class:"form-section"},he={key:0,class:"resubmit-notice"},ke={class:"form-actions"},we={__name:"submit",setup(Ce){const _=ee(),z=m(),N=m(),M=m({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),k=m([]),b=h(()=>_.currentRoute.value.query.resubmit==="true"),d=h(()=>_.currentRoute.value.query.improvement==="true"),V=h(()=>d.value?"提交整改材料":b.value?"重新提交立项申请":"提交立项申请"),O=h(()=>d.value?"根据立项会议的整改要求，提交相应的整改材料和说明":b.value?"根据审核意见修改完善后重新提交立项申请":"填写项目立项申请信息并上传相关材料"),n=m({year:"2024",projectName:"",applicant:"",department:"",duration:void 0,budget:void 0,expectedDate:void 0,description:"",remarks:""}),F={year:[{required:!0,message:"请选择年度"}],projectName:[{required:!0,message:"请输入立项名称"}],applicant:[{required:!0,message:"请输入申请人姓名"}],department:[{required:!0,message:"请输入申请单位"}],duration:[{required:!0,message:"请输入项目周期"}],budget:[{required:!0,message:"请输入项目预算"}],expectedDate:[{required:!0,message:"请选择预期立项时间"}],description:[{required:!0,message:"请填写申请说明"}]},D=m([{key:"acceptance_report",name:"项目立项报告",description:"详细的项目立项报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),B=m([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目立项相关的补充材料",fileList:[]}]),L=m(!1),g=m("");m(!1),m({});const E=a=>a&&a<C().startOf("day"),A=()=>{_.go(-1)},P=async()=>{try{c.success("草稿保存成功")}catch{c.error("草稿保存失败")}},$=async a=>{try{L.value=!0;const t=D.value.filter(r=>r.fileList.length===0);if(t.length>0){c.error(`请上传必需材料：${t.map(r=>r.name).join("、")}`);return}const p={...a,materials:{required:D.value.reduce((r,l)=>(r[l.key]=l.fileList,r),{}),optional:B.value.reduce((r,l)=>(r[l.key]=l.fileList,r),{})}};console.log("Submit data:",p),await new Promise(r=>setTimeout(r,2e3)),c.success("立项申请提交成功"),_.push("/implementation/approval?tab=application-manage")}catch{c.error("提交失败，请重试")}finally{L.value=!1}},G=a=>{const{configId:t,file:p,action:r}=a;if(r==="add")k.value.push({configId:t,file:p});else if(r==="remove"){const l=k.value.findIndex(x=>x.configId===t);l>-1&&k.value.splice(l,1)}},H=a=>{M.value=a},J=a=>{console.log("立项材料配置已更新:",a)};return te(()=>{const a=_.currentRoute.value;a.query.resubmit==="true"&&(a.query.expectedTime&&(n.value.expectedDate=C(a.query.expectedTime)),a.query.description&&(n.value.description=decodeURIComponent(a.query.description)),a.query.rejectionReason?g.value=decodeURIComponent(a.query.rejectionReason):a.query.reviewComments&&(g.value=decodeURIComponent(a.query.reviewComments)),c.info("请重新上传立项材料并完善申请信息")),a.query.improvement==="true"&&(a.query.expectedTime&&(n.value.expectedDate=C(a.query.expectedTime)),a.query.description&&(n.value.description=decodeURIComponent(a.query.description)),a.query.improvementRequirements&&(g.value=decodeURIComponent(a.query.improvementRequirements)),c.info("请根据整改要求上传相关材料"))}),(a,t)=>{const p=u("a-button"),r=u("a-input"),l=u("a-form-item"),x=u("a-select-option"),K=u("a-select"),f=u("a-col"),w=u("a-row"),S=u("a-input-number"),Q=u("a-date-picker"),T=u("a-textarea"),j=u("a-alert"),W=u("a-space"),X=u("a-form"),Y=u("a-card");return U(),R("div",ie,[i("div",ue,[i("div",de,[i("h1",me,y(V.value),1),i("p",pe,y(O.value),1)]),i("div",ce,[e(p,{onClick:A},{default:s(()=>[e(q(ae)),t[9]||(t[9]=v(" 返回列表 "))]),_:1,__:[9]})])]),e(Y,{bordered:!1},{default:s(()=>[e(X,{ref_key:"formRef",ref:z,model:n.value,rules:F,layout:"vertical",onFinish:$},{default:s(()=>[i("div",ve,[i("div",fe,[i("h3",null,[e(q(se)),t[10]||(t[10]=v(" 申请信息 "))]),t[11]||(t[11]=i("p",null,"填写立项申请的基本信息",-1))]),i("div",_e,[e(l,{label:"立项名称",name:"projectName",rules:[{required:!0,message:"请输入立项名称"}]},{default:s(()=>[e(r,{value:n.value.projectName,"onUpdate:value":t[0]||(t[0]=o=>n.value.projectName=o),placeholder:"请输入立项名称",size:"large"},null,8,["value"])]),_:1}),e(w,{gutter:24},{default:s(()=>[e(f,{xs:24,md:12},{default:s(()=>[e(l,{label:"年度",name:"year",rules:[{required:!0,message:"请选择年度"}]},{default:s(()=>[e(K,{value:n.value.year,"onUpdate:value":t[1]||(t[1]=o=>n.value.year=o),placeholder:"请选择年度",size:"large"},{default:s(()=>[e(x,{value:"2024"},{default:s(()=>t[12]||(t[12]=[v("2024")])),_:1,__:[12]}),e(x,{value:"2025"},{default:s(()=>t[13]||(t[13]=[v("2025")])),_:1,__:[13]})]),_:1},8,["value"])]),_:1})]),_:1}),e(f,{xs:24,md:12},{default:s(()=>[e(l,{label:"申请人",name:"applicant",rules:[{required:!0,message:"请输入申请人姓名"}]},{default:s(()=>[e(r,{value:n.value.applicant,"onUpdate:value":t[2]||(t[2]=o=>n.value.applicant=o),placeholder:"请输入申请人姓名",size:"large"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:24},{default:s(()=>[e(f,{xs:24,md:12},{default:s(()=>[e(l,{label:"申请单位",name:"department",rules:[{required:!0,message:"请输入申请单位"}]},{default:s(()=>[e(r,{value:n.value.department,"onUpdate:value":t[3]||(t[3]=o=>n.value.department=o),placeholder:"请输入申请单位",size:"large"},null,8,["value"])]),_:1})]),_:1}),e(f,{xs:24,md:12},{default:s(()=>[e(l,{label:"项目周期(月)",name:"duration",rules:[{required:!0,message:"请输入项目周期"}]},{default:s(()=>[e(S,{value:n.value.duration,"onUpdate:value":t[4]||(t[4]=o=>n.value.duration=o),placeholder:"请输入项目周期",size:"large",min:1,max:60,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:24},{default:s(()=>[e(f,{xs:24,md:12},{default:s(()=>[e(l,{label:"预算(万元)",name:"budget",rules:[{required:!0,message:"请输入项目预算"}]},{default:s(()=>[e(S,{value:n.value.budget,"onUpdate:value":t[5]||(t[5]=o=>n.value.budget=o),placeholder:"请输入项目预算",size:"large",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(f,{xs:24,md:12},{default:s(()=>[e(l,{label:"预期立项时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期立项时间"}]},{default:s(()=>[e(Q,{value:n.value.expectedDate,"onUpdate:value":t[6]||(t[6]=o=>n.value.expectedDate=o),placeholder:"请选择预期立项时间",size:"large",style:{width:"100%"},"disabled-date":E},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(l,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:s(()=>[e(T,{value:n.value.description,"onUpdate:value":t[7]||(t[7]=o=>n.value.description=o),placeholder:"请详细说明项目完成情况、主要成果及立项准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),e(l,{label:"备注说明",name:"remarks"},{default:s(()=>[e(T,{value:n.value.remarks,"onUpdate:value":t[8]||(t[8]=o=>n.value.remarks=o),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(b.value||d.value)&&g.value?(U(),R("div",ge,[i("div",ye,[i("h3",null,[e(q(ne)),v(" "+y(d.value?"整改要求":"审核意见"),1)]),i("p",null,"请仔细阅读以下"+y(d.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),i("div",qe,[e(j,{message:d.value?"立项会议整改要求":"材料审核意见",type:d.value?"warning":"error","show-icon":""},{description:s(()=>[i("div",be,y(g.value),1)]),_:1},8,["message","type"])])])):I("",!0),i("div",xe,[b.value||d.value?(U(),R("div",he,[e(j,{message:d.value?"整改材料提交":"重新提交提醒",description:d.value?"请根据立项会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:d.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):I("",!0),e(re,{ref_key:"materialTemplateSyncRef",ref:N,"business-type":"apply",onFilesChange:G,onValidationChange:H,onConfigUpdate:J},null,512)]),i("div",ke,[e(W,null,{default:s(()=>[e(p,{onClick:P},{default:s(()=>[e(q(le)),t[14]||(t[14]=v(" 保存草稿 "))]),_:1,__:[14]}),e(p,{type:"primary","html-type":"submit"},{default:s(()=>[e(q(oe)),t[15]||(t[15]=v(" 提交申请 "))]),_:1,__:[15]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},je=Z(we,[["__scopeId","data-v-00100fcc"]]);export{je as default};
