import{_ as oe,a as m,c as C,h as se,o as ne,s as D,k as g,b as I,d as s,e as a,t as u,w as o,g as c,i as h,j as i,m as b,U as le,p as T,v as re,x as ie,f as de,F as ue,E as ce}from"./index-XOIS1SV9.js";/* empty css                                                                    */import{M as pe}from"./MaterialTemplateSync-DJgW6a9z.js";import{P as me}from"./ProjectOutlined-yHSSU9z4.js";import{S as _e}from"./SaveOutlined-B5HJe_0O.js";import{S as fe}from"./SendOutlined-CSHeOdSH.js";import"./UploadOutlined-BeZhUyI8.js";const ve={class:"submit-container"},ye={class:"page-header"},ge={class:"header-content"},he={class:"page-title"},be={class:"page-description"},qe={class:"header-actions"},je={class:"form-section"},xe={class:"section-header"},Ce={class:"section-content"},Ie={class:"project-option"},ke={class:"project-name"},Re={class:"project-info"},we={class:"project-code"},De={class:"project-status"},Te={key:0,class:"selected-project-info"},Ue={class:"form-section"},Le={class:"section-header"},Se={class:"section-content"},Oe={key:0,class:"form-section"},Fe={class:"section-header"},Pe={class:"review-comments-content"},ze={class:"comments-text"},Ne={class:"form-section"},Ve={key:0,class:"resubmit-notice"},Me={class:"form-actions"},Be={__name:"submit",setup(Ae){const q=se(),P=m(),R=m(),U=m({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),w=m([]),k=C(()=>q.currentRoute.value.query.resubmit==="true"),_=C(()=>q.currentRoute.value.query.improvement==="true"),z=C(()=>_.value?"提交整改材料":k.value?"重新提交验收申请":"提交验收申请"),N=C(()=>_.value?"根据验收会议的整改要求，提交相应的整改材料和说明":k.value?"根据审核意见修改完善后重新提交验收申请":"填写项目验收申请信息并上传相关材料"),n=m({projectId:void 0,expectedDate:void 0,acceptanceType:void 0,description:"",remarks:""}),V={projectId:[{required:!0,message:"请选择项目"}],expectedDate:[{required:!0,message:"请选择预期验收时间"}],acceptanceType:[{required:!0,message:"请选择验收类型"}],description:[{required:!0,message:"请填写申请说明"}]},j=m([{id:1,name:"智慧城市大数据平台建设项目",code:"PROJ-2024-001",status:"实施中",startDate:"2023-06-01",endDate:"2024-05-31",leader:"张三",budget:500},{id:2,name:"区块链供应链金融平台",code:"PROJ-2024-002",status:"实施中",startDate:"2023-08-01",endDate:"2024-07-31",leader:"李四",budget:300},{id:3,name:"AI智能客服系统",code:"PROJ-2024-003",status:"即将结束",startDate:"2023-09-01",endDate:"2024-03-31",leader:"王五",budget:200}]),f=C(()=>j.value.find(t=>t.id===n.value.projectId));m([{key:"acceptance_report",name:"项目验收报告",description:"详细的项目验收报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),m([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目验收相关的补充材料",fileList:[]}]);const L=m(!1),x=m("");m(!1),m({});const M=t=>({实施中:"blue",即将结束:"orange",已完成:"green",暂停:"red"})[t]||"default",B=(t,e)=>{const p=j.value.find(r=>r.id===e.value);return p&&(p.name.toLowerCase().includes(t.toLowerCase())||p.code.toLowerCase().includes(t.toLowerCase()))},A=t=>t&&t<D().startOf("day"),E=()=>{q.go(-1)},J=t=>{console.log("Selected project:",t)},$=t=>{const{configId:e,file:p,action:r}=t;if(r==="add")w.value.push({configId:e,file:p});else if(r==="remove"){const v=w.value.findIndex(l=>l.configId===e);v>-1&&w.value.splice(v,1)}},G=t=>{U.value=t},H=t=>{console.log("开题材料配置已更新:",t)},K=async()=>{try{g.success("草稿保存成功")}catch{g.error("草稿保存失败")}},Q=async t=>{var e,p;try{if(L.value=!0,!U.value.allRequiredUploaded){const l=(e=R.value)==null?void 0:e.validateRequiredFiles();if(l&&!l.valid){g.error(`请上传以下必传材料：${l.missingFiles.join("、")}`);return}}const r=((p=R.value)==null?void 0:p.getAllUploadedFiles())||[],v={...t,materials:r.map(l=>({configId:l.configId,categoryName:l.config.categoryName,fileName:l.file.name,fileSize:l.file.size,isRequired:l.config.isRequired}))};console.log("Submit data:",v),await new Promise(l=>setTimeout(l,2e3)),g.success("开题申请提交成功"),q.push("/opening/applicant/manage")}catch{g.error("提交失败，请重试")}finally{L.value=!1}};return ne(()=>{const t=q.currentRoute.value;if(t.query.resubmit==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);j.value.find(r=>r.id===e)&&(n.value.projectId=e)}t.query.expectedTime&&(n.value.expectedDate=D(t.query.expectedTime)),t.query.description&&(n.value.description=decodeURIComponent(t.query.description)),t.query.rejectionReason?x.value=decodeURIComponent(t.query.rejectionReason):t.query.reviewComments&&(x.value=decodeURIComponent(t.query.reviewComments)),n.value.acceptanceType="final",g.info("已自动填充项目信息，请重新上传验收材料并完善申请信息")}if(t.query.improvement==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);j.value.find(r=>r.id===e)&&(n.value.projectId=e)}t.query.expectedTime&&(n.value.expectedDate=D(t.query.expectedTime)),t.query.description&&(n.value.description=decodeURIComponent(t.query.description)),t.query.improvementRequirements&&(x.value=decodeURIComponent(t.query.improvementRequirements)),n.value.acceptanceType="final",g.info("已自动填充项目信息，请根据整改要求上传相关材料")}}),(t,e)=>{const p=c("a-button"),r=c("a-select-option"),v=c("a-select"),l=c("a-form-item"),y=c("a-descriptions-item"),W=c("a-tag"),X=c("a-descriptions"),Y=c("a-date-picker"),S=c("a-col"),Z=c("a-row"),O=c("a-textarea"),F=c("a-alert"),ee=c("a-space"),te=c("a-form"),ae=c("a-card");return h(),I("div",ve,[s("div",ye,[s("div",ge,[s("h1",he,u(z.value),1),s("p",be,u(N.value),1)]),s("div",qe,[a(p,{onClick:E},{default:o(()=>[a(b(le)),e[5]||(e[5]=i(" 返回列表 "))]),_:1,__:[5]})])]),a(ae,{bordered:!1},{default:o(()=>[a(te,{ref_key:"formRef",ref:P,model:n.value,rules:V,layout:"vertical",onFinish:Q},{default:o(()=>[s("div",je,[s("div",xe,[s("h3",null,[a(b(me)),e[6]||(e[6]=i(" 项目选择 "))]),e[7]||(e[7]=s("p",null,"选择需要申请开题的项目",-1))]),s("div",Ce,[a(l,{label:"选择项目",name:"projectId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[a(v,{value:n.value.projectId,"onUpdate:value":e[0]||(e[0]=d=>n.value.projectId=d),placeholder:"请选择项目",size:"large","show-search":"","filter-option":B,onChange:J},{default:o(()=>[(h(!0),I(re,null,ie(j.value,d=>(h(),de(r,{key:d.id,value:d.id},{default:o(()=>[s("div",Ie,[s("div",ke,u(d.name),1),s("div",Re,[s("span",we,u(d.code),1),s("span",De,u(d.status),1)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),f.value?(h(),I("div",Te,[a(X,{column:2,bordered:"",size:"small"},{default:o(()=>[a(y,{label:"项目名称",span:2},{default:o(()=>[i(u(f.value.name),1)]),_:1}),a(y,{label:"项目编号"},{default:o(()=>[i(u(f.value.code),1)]),_:1}),a(y,{label:"项目状态"},{default:o(()=>[a(W,{color:M(f.value.status)},{default:o(()=>[i(u(f.value.status),1)]),_:1},8,["color"])]),_:1}),a(y,{label:"开始时间"},{default:o(()=>[i(u(f.value.startDate),1)]),_:1}),a(y,{label:"计划结束时间"},{default:o(()=>[i(u(f.value.endDate),1)]),_:1}),a(y,{label:"项目负责人"},{default:o(()=>[i(u(f.value.leader),1)]),_:1}),a(y,{label:"项目总预算"},{default:o(()=>[i(u(f.value.budget)+"万元 ",1)]),_:1})]),_:1})])):T("",!0)])]),s("div",Ue,[s("div",Le,[s("h3",null,[a(b(ue)),e[8]||(e[8]=i(" 申请信息 "))]),e[9]||(e[9]=s("p",null,"填写开题申请的基本信息",-1))]),s("div",Se,[a(Z,{gutter:24},{default:o(()=>[a(S,{xs:24,md:12},{default:o(()=>[a(l,{label:"预期开题时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期验收时间"}]},{default:o(()=>[a(Y,{value:n.value.expectedDate,"onUpdate:value":e[1]||(e[1]=d=>n.value.expectedDate=d),placeholder:"请选择预期开题时间",size:"large",style:{width:"100%"},"disabled-date":A},null,8,["value"])]),_:1})]),_:1}),a(S,{xs:24,md:12},{default:o(()=>[a(l,{label:"开题类型",name:"acceptanceType",rules:[{required:!0,message:"请选择验收类型"}]},{default:o(()=>[a(v,{value:n.value.acceptanceType,"onUpdate:value":e[2]||(e[2]=d=>n.value.acceptanceType=d),placeholder:"请选择验收类型",size:"large"},{default:o(()=>[a(r,{value:"preliminary"},{default:o(()=>e[10]||(e[10]=[i("初步开题")])),_:1,__:[10]}),a(r,{value:"formal"},{default:o(()=>e[11]||(e[11]=[i("正式开题")])),_:1,__:[11]}),a(r,{value:"special"},{default:o(()=>e[12]||(e[12]=[i("专项开题")])),_:1,__:[12]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(l,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:o(()=>[a(O,{value:n.value.description,"onUpdate:value":e[3]||(e[3]=d=>n.value.description=d),placeholder:"请详细说明项目准备情况、研究方案及开题准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),a(l,{label:"备注说明",name:"remarks"},{default:o(()=>[a(O,{value:n.value.remarks,"onUpdate:value":e[4]||(e[4]=d=>n.value.remarks=d),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(k.value||_.value)&&x.value?(h(),I("div",Oe,[s("div",Fe,[s("h3",null,[a(b(ce)),i(" "+u(_.value?"整改要求":"审核意见"),1)]),s("p",null,"请仔细阅读以下"+u(_.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),s("div",Pe,[a(F,{message:_.value?"开题会议整改要求":"材料审核意见",type:_.value?"warning":"error","show-icon":""},{description:o(()=>[s("div",ze,u(x.value),1)]),_:1},8,["message","type"])])])):T("",!0),s("div",Ne,[k.value||_.value?(h(),I("div",Ve,[a(F,{message:_.value?"整改材料提交":"重新提交提醒",description:_.value?"请根据开题会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:_.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):T("",!0),a(pe,{ref_key:"materialTemplateSyncRef",ref:R,"business-type":"opening",onFilesChange:$,onValidationChange:G,onConfigUpdate:H},null,512)]),s("div",Me,[a(ee,null,{default:o(()=>[a(p,{onClick:K},{default:o(()=>[a(b(_e)),e[13]||(e[13]=i(" 保存草稿 "))]),_:1,__:[13]}),a(p,{type:"primary","html-type":"submit"},{default:o(()=>[a(b(fe)),e[14]||(e[14]=i(" 提交申请 "))]),_:1,__:[14]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},We=oe(Be,[["__scopeId","data-v-437eaaa3"]]);export{We as default};
