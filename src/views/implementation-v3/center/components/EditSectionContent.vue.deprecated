<!--
 * @file ç¼–è¾‘åŒºåŸŸå†…å®¹ç»„ä»¶
 * @description ç”¨äºç¼–è¾‘ç”³æŠ¥ä¹¦è§£æçš„å„ä¸ªåŒºåŸŸå†…å®¹
 * @author ç§‘ç ”ç®¡ç†ç³»ç»Ÿ
 * @version 3.0.0
 * @date 2025-01-29
-->
<template>
  <div class="edit-section-content">
    <!-- ç¼–è¾‘è¯´æ˜ -->
    <a-alert
      :message="`ç¼–è¾‘ ${sectionTitle} å†…å®¹`"
      type="info"
      show-icon
      style="margin-bottom: 16px"
    >
      <template #description>
        <p>æ‚¨å¯ä»¥å¯¹è±†åŒ…è§£æçš„å†…å®¹è¿›è¡ŒäºŒæ¬¡ç¼–è¾‘å’Œå®Œå–„ï¼Œæ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼ã€‚</p>
      </template>
    </a-alert>

    <!-- ç¼–è¾‘å™¨ -->
    <div class="editor-container">
      <div class="editor-toolbar">
        <a-space>
          <a-button size="small" @click="insertTemplate">
            <FileAddOutlined />
            æ’å…¥æ¨¡æ¿
          </a-button>
          <a-button size="small" @click="formatContent">
            <FormatPainterOutlined />
            æ ¼å¼åŒ–
          </a-button>
          <a-button size="small" @click="clearContent">
            <ClearOutlined />
            æ¸…ç©º
          </a-button>
          <a-divider type="vertical" />
          <span class="word-count">å­—æ•°ï¼š{{ wordCount }}</span>
        </a-space>
      </div>
      
      <a-textarea
        v-model:value="content"
        :placeholder="getPlaceholder()"
        :rows="12"
        class="content-editor"
        @input="handleInput"
      />
    </div>

    <!-- ç¼–è¾‘è¾…åŠ©åŠŸèƒ½ -->
    <div class="edit-helpers">
      <a-row :gutter="16">
        <!-- å¸¸ç”¨æ¨¡æ¿ -->
        <a-col :span="12">
          <div class="helper-section">
            <h4>ğŸ“ å¸¸ç”¨æ¨¡æ¿</h4>
            <div class="template-buttons">
              <a-button 
                v-for="template in getTemplates()" 
                :key="template.key"
                size="small" 
                @click="insertTemplateContent(template)"
                style="margin: 4px;"
              >
                {{ template.name }}
              </a-button>
            </div>
          </div>
        </a-col>
        
        <!-- ç¼–è¾‘æç¤º -->
        <a-col :span="12">
          <div class="helper-section">
            <h4>ğŸ’¡ ç¼–è¾‘æç¤º</h4>
            <ul class="edit-tips">
              <li v-for="tip in getEditTips()" :key="tip">{{ tip }}</li>
            </ul>
          </div>
        </a-col>
      </a-row>
    </div>

    <!-- é¢„è§ˆæ¨¡å¼ -->
    <div class="preview-section" v-if="showPreview">
      <a-divider>å†…å®¹é¢„è§ˆ</a-divider>
      <div class="preview-content">
        <pre>{{ content }}</pre>
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="edit-actions">
      <a-space>
        <a-button @click="togglePreview">
          <EyeOutlined />
          {{ showPreview ? 'éšè—é¢„è§ˆ' : 'æ˜¾ç¤ºé¢„è§ˆ' }}
        </a-button>
        <a-button @click="resetContent">
          <ReloadOutlined />
          é‡ç½®å†…å®¹
        </a-button>
        <a-button @click="saveAsDraft">
          <SaveOutlined />
          ä¿å­˜è‰ç¨¿
        </a-button>
      </a-space>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'
import { message } from 'ant-design-vue'
import { 
  FileAddOutlined, 
  FormatPainterOutlined, 
  ClearOutlined,
  EyeOutlined,
  ReloadOutlined,
  SaveOutlined
} from '@ant-design/icons-vue'

// Props
const props = defineProps({
  sectionTitle: {
    type: String,
    required: true
  }
})

// Model
const content = defineModel('content', {
  type: String,
  default: ''
})

// å“åº”å¼æ•°æ®
const showPreview = ref(false)
const originalContent = ref('')

// è®¡ç®—å±æ€§
const wordCount = computed(() => {
  return content.value.length
})

// ç›‘å¬å™¨
watch(() => content.value, (newValue) => {
  if (originalContent.value === '') {
    originalContent.value = newValue
  }
}, { immediate: true })

// æ–¹æ³•å®šä¹‰

/**
 * è·å–å ä½ç¬¦æ–‡æœ¬
 */
const getPlaceholder = () => {
  const placeholders = {
    'ğŸ“Š é¡¹ç›®æ¦‚å†µ': 'è¯·è¾“å…¥é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¡¹ç›®åç§°ã€ç”³è¯·å•ä½ã€è´Ÿè´£äººç­‰...',
    'ğŸ› ï¸ å®æ–½æ–¹æ¡ˆ': 'è¯·è¯¦ç»†æè¿°é¡¹ç›®çš„å®æ–½æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å®æ–½æ­¥éª¤ã€å·¥ä½œå†…å®¹ã€æ—¶é—´å®‰æ’ç­‰...',
    'ğŸ”¬ æŠ€æœ¯è·¯çº¿': 'è¯·æè¿°é¡¹ç›®çš„æŠ€æœ¯è·¯çº¿ï¼ŒåŒ…æ‹¬æŠ€æœ¯æ–¹æ¡ˆã€å…³é”®æŠ€æœ¯ã€å®ç°è·¯å¾„ç­‰...',
    'ğŸ“… è¿›åº¦è®¡åˆ’': 'è¯·åˆ¶å®šè¯¦ç»†çš„é¡¹ç›®è¿›åº¦è®¡åˆ’ï¼ŒåŒ…æ‹¬å„é˜¶æ®µæ—¶é—´èŠ‚ç‚¹ã€é‡Œç¨‹ç¢‘ç­‰...',
    'ğŸ”‘ æŠ€æœ¯å…³é”®': 'è¯·è¯´æ˜é¡¹ç›®çš„å…³é”®æŠ€æœ¯éš¾ç‚¹ã€æŠ€æœ¯åˆ›æ–°ç‚¹ã€è§£å†³æ–¹æ¡ˆç­‰...',
    'ğŸ‘¥ å›¢é˜Ÿä¿¡æ¯': 'è¯·ä»‹ç»é¡¹ç›®å›¢é˜Ÿæˆå‘˜ã€åˆ†å·¥å®‰æ’ã€èƒ½åŠ›åŒ¹é…ç­‰ä¿¡æ¯...',
    'ğŸ“ˆ æ•ˆç›Šé¢„æœŸ': 'è¯·æè¿°é¡¹ç›®é¢„æœŸäº§ç”Ÿçš„ç»æµæ•ˆç›Šã€ç¤¾ä¼šæ•ˆç›Šã€ç¯å¢ƒæ•ˆç›Šç­‰...'
  }
  return placeholders[props.sectionTitle] || 'è¯·è¾“å…¥å†…å®¹...'
}

/**
 * è·å–æ¨¡æ¿åˆ—è¡¨
 */
const getTemplates = () => {
  const templates = {
    'ğŸ“Š é¡¹ç›®æ¦‚å†µ': [
      { key: 'basic', name: 'åŸºæœ¬ä¿¡æ¯', content: 'é¡¹ç›®åç§°ï¼š\nç”³è¯·å•ä½ï¼š\né¡¹ç›®è´Ÿè´£äººï¼š\nåä½œå•ä½ï¼š\nç”³æŠ¥æ—¶é—´ï¼š' },
      { key: 'summary', name: 'é¡¹ç›®æ‘˜è¦', content: 'é¡¹ç›®èƒŒæ™¯ï¼š\nç ”ç©¶ç›®æ ‡ï¼š\nä¸»è¦å†…å®¹ï¼š\né¢„æœŸæˆæœï¼š' }
    ],
    'ğŸ› ï¸ å®æ–½æ–¹æ¡ˆ': [
      { key: 'phases', name: 'åˆ†é˜¶æ®µå®æ–½', content: 'ç¬¬ä¸€é˜¶æ®µï¼š\nç¬¬äºŒé˜¶æ®µï¼š\nç¬¬ä¸‰é˜¶æ®µï¼š' },
      { key: 'tasks', name: 'ä»»åŠ¡åˆ†è§£', content: 'ä¸»è¦ä»»åŠ¡ï¼š\n1. \n2. \n3. ' },
      { key: 'methods', name: 'å®æ–½æ–¹æ³•', content: 'å®æ–½æ–¹æ³•ï¼š\nè´¨é‡æ§åˆ¶ï¼š\né£é™©ç®¡æ§ï¼š' }
    ],
    'ğŸ”¬ æŠ€æœ¯è·¯çº¿': [
      { key: 'route', name: 'æŠ€æœ¯è·¯å¾„', content: 'æŠ€æœ¯è·¯çº¿ï¼š\nè¾“å…¥ â†’ å¤„ç† â†’ è¾“å‡º' },
      { key: 'architecture', name: 'ç³»ç»Ÿæ¶æ„', content: 'ç³»ç»Ÿæ¶æ„ï¼š\næ•°æ®å±‚ï¼š\nä¸šåŠ¡å±‚ï¼š\nè¡¨ç°å±‚ï¼š' },
      { key: 'algorithms', name: 'æ ¸å¿ƒç®—æ³•', content: 'æ ¸å¿ƒç®—æ³•ï¼š\n1. \n2. \n3. ' }
    ],
    'ğŸ“… è¿›åº¦è®¡åˆ’': [
      { key: 'timeline', name: 'æ—¶é—´èŠ‚ç‚¹', content: 'é¡¹ç›®å‘¨æœŸï¼š\nå¼€å§‹æ—¶é—´ï¼š\nç»“æŸæ—¶é—´ï¼š\nå…³é”®èŠ‚ç‚¹ï¼š' },
      { key: 'milestones', name: 'é‡Œç¨‹ç¢‘', content: 'é‡Œç¨‹ç¢‘1ï¼š\né‡Œç¨‹ç¢‘2ï¼š\né‡Œç¨‹ç¢‘3ï¼š' },
      { key: 'deliverables', name: 'äº¤ä»˜ç‰©', content: 'é˜¶æ®µäº¤ä»˜ç‰©ï¼š\n1. \n2. \n3. ' }
    ],
    'ğŸ”‘ æŠ€æœ¯å…³é”®': [
      { key: 'challenges', name: 'æŠ€æœ¯éš¾ç‚¹', content: 'æŠ€æœ¯éš¾ç‚¹ï¼š\n1. \n2. \nè§£å†³æ–¹æ¡ˆï¼š' },
      { key: 'innovations', name: 'åˆ›æ–°ç‚¹', content: 'æŠ€æœ¯åˆ›æ–°ï¼š\næ–¹æ³•åˆ›æ–°ï¼š\nåº”ç”¨åˆ›æ–°ï¼š' },
      { key: 'risks', name: 'é£é™©åˆ†æ', content: 'æŠ€æœ¯é£é™©ï¼š\nåº”å¯¹æªæ–½ï¼š\nå¤‡é€‰æ–¹æ¡ˆï¼š' }
    ],
    'ğŸ‘¥ å›¢é˜Ÿä¿¡æ¯': [
      { key: 'members', name: 'å›¢é˜Ÿæˆå‘˜', content: 'é¡¹ç›®è´Ÿè´£äººï¼š\næ ¸å¿ƒæˆå‘˜ï¼š\næŠ€æœ¯éª¨å¹²ï¼š' },
      { key: 'division', name: 'åˆ†å·¥å®‰æ’', content: 'è´Ÿè´£äººèŒè´£ï¼š\næˆå‘˜åˆ†å·¥ï¼š\nåä½œæœºåˆ¶ï¼š' },
      { key: 'capabilities', name: 'èƒ½åŠ›åŒ¹é…', content: 'æŠ€æœ¯èƒ½åŠ›ï¼š\nç®¡ç†èƒ½åŠ›ï¼š\nèµ„æºä¿éšœï¼š' }
    ],
    'ğŸ“ˆ æ•ˆç›Šé¢„æœŸ': [
      { key: 'economic', name: 'ç»æµæ•ˆç›Š', content: 'ç›´æ¥ç»æµæ•ˆç›Šï¼š\né—´æ¥ç»æµæ•ˆç›Šï¼š\næŠ•èµ„å›æŠ¥ï¼š' },
      { key: 'social', name: 'ç¤¾ä¼šæ•ˆç›Š', content: 'ç¤¾ä¼šä»·å€¼ï¼š\nåº”ç”¨å‰æ™¯ï¼š\næ¨å¹¿ä»·å€¼ï¼š' },
      { key: 'environmental', name: 'ç¯å¢ƒæ•ˆç›Š', content: 'ç¯å¢ƒä¿æŠ¤ï¼š\nèµ„æºèŠ‚çº¦ï¼š\nå¯æŒç»­å‘å±•ï¼š' }
    ]
  }
  
  return templates[props.sectionTitle] || []
}

/**
 * è·å–ç¼–è¾‘æç¤º
 */
const getEditTips = () => {
  const tips = {
    'ğŸ“Š é¡¹ç›®æ¦‚å†µ': [
      'ç¡®ä¿é¡¹ç›®åç§°å‡†ç¡®å®Œæ•´',
      'æ ¸å®ç”³è¯·å•ä½å’Œè´Ÿè´£äººä¿¡æ¯',
      'è¡¥å……åä½œå•ä½ç›¸å…³ä¿¡æ¯'
    ],
    'ğŸ› ï¸ å®æ–½æ–¹æ¡ˆ': [
      'è¯¦ç»†æè¿°æ¯ä¸ªå®æ–½é˜¶æ®µ',
      'æ˜ç¡®å„é˜¶æ®µçš„å·¥ä½œå†…å®¹',
      'åˆç†å®‰æ’æ—¶é—´å’Œèµ„æº'
    ],
    'ğŸ”¬ æŠ€æœ¯è·¯çº¿': [
      'æ¸…æ™°æè¿°æŠ€æœ¯å®ç°è·¯å¾„',
      'çªå‡ºå…³é”®æŠ€æœ¯å’Œåˆ›æ–°ç‚¹',
      'ç¡®ä¿æŠ€æœ¯æ–¹æ¡ˆå¯è¡Œæ€§'
    ],
    'ğŸ“… è¿›åº¦è®¡åˆ’': [
      'åˆ¶å®šåˆç†çš„æ—¶é—´èŠ‚ç‚¹',
      'è®¾ç½®æ¸…æ™°çš„é‡Œç¨‹ç¢‘',
      'è€ƒè™‘é£é™©å’Œç¼“å†²æ—¶é—´'
    ],
    'ğŸ”‘ æŠ€æœ¯å…³é”®': [
      'è¯†åˆ«çœŸæ­£çš„æŠ€æœ¯éš¾ç‚¹',
      'æå‡ºå¯è¡Œçš„è§£å†³æ–¹æ¡ˆ',
      'è¯„ä¼°æŠ€æœ¯é£é™©å’Œåº”å¯¹æªæ–½'
    ],
    'ğŸ‘¥ å›¢é˜Ÿä¿¡æ¯': [
      'ä»‹ç»å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜',
      'è¯´æ˜ä¸“ä¸šèƒ½åŠ›åŒ¹é…',
      'æ˜ç¡®åˆ†å·¥å’Œåä½œæœºåˆ¶'
    ],
    'ğŸ“ˆ æ•ˆç›Šé¢„æœŸ': [
      'é‡åŒ–ç»æµæ•ˆç›ŠæŒ‡æ ‡',
      'æè¿°ç¤¾ä¼šä»·å€¼å’Œæ„ä¹‰',
      'è¯„ä¼°ç¯å¢ƒå½±å“å’Œè´¡çŒ®'
    ]
  }
  
  return tips[props.sectionTitle] || ['æ³¨æ„å†…å®¹çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§', 'ä¿æŒé€»è¾‘æ¸…æ™°å’Œæ¡ç†æ€§', 'ä½¿ç”¨ä¸“ä¸šæœ¯è¯­å’Œè§„èŒƒè¡¨è¾¾']
}

/**
 * å¤„ç†è¾“å…¥
 */
const handleInput = () => {
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å®æ—¶ä¿å­˜ã€è‡ªåŠ¨è¡¥å…¨ç­‰åŠŸèƒ½
}

/**
 * æ’å…¥æ¨¡æ¿
 */
const insertTemplate = () => {
  const templates = getTemplates()
  if (templates.length > 0) {
    insertTemplateContent(templates[0])
  }
}

/**
 * æ’å…¥æ¨¡æ¿å†…å®¹
 */
const insertTemplateContent = (template) => {
  if (content.value.trim()) {
    content.value += '\n\n' + template.content
  } else {
    content.value = template.content
  }
  message.success(`å·²æ’å…¥${template.name}æ¨¡æ¿`)
}

/**
 * æ ¼å¼åŒ–å†…å®¹
 */
const formatContent = () => {
  // ç®€å•çš„æ ¼å¼åŒ–ï¼šç»Ÿä¸€æ¢è¡Œç¬¦ã€å»é™¤å¤šä½™ç©ºæ ¼
  let formatted = content.value
    .replace(/\r\n/g, '\n')
    .replace(/\n{3,}/g, '\n\n')
    .replace(/[ \t]+/g, ' ')
    .trim()
  
  content.value = formatted
  message.success('å†…å®¹æ ¼å¼åŒ–å®Œæˆ')
}

/**
 * æ¸…ç©ºå†…å®¹
 */
const clearContent = () => {
  content.value = ''
  message.success('å†…å®¹å·²æ¸…ç©º')
}

/**
 * åˆ‡æ¢é¢„è§ˆ
 */
const togglePreview = () => {
  showPreview.value = !showPreview.value
}

/**
 * é‡ç½®å†…å®¹
 */
const resetContent = () => {
  content.value = originalContent.value
  message.success('å†…å®¹å·²é‡ç½®')
}

/**
 * ä¿å­˜è‰ç¨¿
 */
const saveAsDraft = () => {
  // è¿™é‡Œå¯ä»¥å®ç°ä¿å­˜è‰ç¨¿çš„é€»è¾‘
  const draftKey = `draft_${props.sectionTitle}_${Date.now()}`
  localStorage.setItem(draftKey, content.value)
  message.success('è‰ç¨¿å·²ä¿å­˜')
}
</script>

<style scoped>
.edit-section-content {
  max-height: 70vh;
  overflow-y: auto;
}

.editor-container {
  margin-bottom: 16px;
}

.editor-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-bottom: none;
  border-radius: 6px 6px 0 0;
}

.word-count {
  font-size: 12px;
  color: #666;
}

.content-editor {
  border-radius: 0 0 6px 6px;
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 14px;
  line-height: 1.6;
}

.edit-helpers {
  margin-bottom: 16px;
}

.helper-section h4 {
  margin: 0 0 12px 0;
  color: #333;
  font-size: 14px;
}

.template-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.edit-tips {
  margin: 0;
  padding-left: 16px;
  font-size: 12px;
  color: #666;
}

.edit-tips li {
  margin: 4px 0;
  line-height: 1.4;
}

.preview-section {
  margin-bottom: 16px;
}

.preview-content {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  max-height: 200px;
  overflow-y: auto;
}

.preview-content pre {
  margin: 0;
  white-space: pre-wrap;
  word-wrap: break-word;
  font-size: 13px;
  line-height: 1.5;
}

.edit-actions {
  text-align: center;
  padding-top: 16px;
  border-top: 1px solid #f0f0f0;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .editor-toolbar {
    flex-direction: column;
    gap: 8px;
  }
  
  .template-buttons {
    justify-content: center;
  }
  
  .edit-helpers .ant-col {
    margin-bottom: 16px;
  }
}
</style>
