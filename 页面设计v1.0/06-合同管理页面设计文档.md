# 📄 合同管理页面设计文档 v1.0

## 📄 页面基础信息

- **页面名称**: 合同管理
- **路由地址**: `/implementation/contract`
- **组件路径**: `src/views/implementation/contract/index.vue`
- **设计版本**: v1.0
- **更新时间**: 2025-01-17

## 🎨 UI布局草图

### 整体页面布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│                    📄 合同管理页面容器                           │
│                   (全屏宽度，背景 #f5f7fa)                       │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                📊 页面头部区域                          │   │
│  │  ┌─────────────────────┐  ┌─────────────────────────┐  │   │
│  │  │ 📄 合同管理          │  │ [选择项目_______▼]      │  │   │
│  │  │ 管理项目合同文件，    │  │ [🔴对接OA流程]         │  │   │
│  │  │ 自动解析付款条款，    │  │                        │  │   │
│  │  │ 集成OA流程与节点配置  │  │                        │  │   │
│  │  └─────────────────────┘  └─────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                📁 合同文件上传与管理区域                 │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ [📁 上传合同文件]                              │   │   │
│  │  │                                                 │   │   │
│  │  │ 📄 合同文件.pdf                                │   │   │
│  │  │ └─ [下载合同] [删除]                           │   │   │
│  │  │                                                 │   │   │
│  │  │ 🔴 合同文件与OA流程同步                        │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                🔍 付款条款自动解析区域                   │   │
│  │                                                         │   │
│  │  ℹ️ 系统将自动解析合同中的付款条款，生成项目节点配置建议。│   │
│  │                                                         │   │
│  │  [🔍 自动解析条款]                                     │   │
│  │                                                         │   │
│  │  ┌─────┬─────┬─────────┬─────────────────────────┐    │   │
│  │  │节点名│金额比│条件说明  │操作                      │    │   │
│  │  │称   │例(%)│         │                         │    │   │
│  │  ├─────┼─────┼─────────┼─────────────────────────┤    │   │
│  │  │首付款│ 30  │合同签订后│[编辑] [删除]             │    │   │
│  │  │     │     │7日内    │                         │    │   │
│  │  ├─────┼─────┼─────────┼─────────────────────────┤    │   │
│  │  │中期款│ 40  │项目进度  │[编辑] [删除]             │    │   │
│  │  │     │     │过半     │                         │    │   │
│  │  ├─────┼─────┼─────────┼─────────────────────────┤    │   │
│  │  │尾款  │ 30  │项目验收  │[编辑] [删除]             │    │   │
│  │  │     │     │合格     │                         │    │   │
│  │  └─────┴─────┴─────────┴─────────────────────────┘    │   │
│  │                                                         │   │
│  │  [⚙️ 跳转到节点配置]                                   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 合同文件上传区域详细设计

```
┌─────────────────────────────────────────────────────────────────┐
│                    📁 合同文件上传与管理区域                     │
│                                                                 │
│  文件上传区域                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              📁 拖拽或点击上传合同文件                   │   │
│  │                                                         │   │
│  │              支持格式: PDF, DOC, DOCX                   │   │
│  │              最大文件: 50MB                             │   │
│  │                                                         │   │
│  │               [📁 选择文件]                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  已上传文件列表                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📄 智能水质监测系统合同.pdf                             │   │
│  │    文件大小: 2.5MB                                      │   │
│  │    上传时间: 2024-01-15 14:30                          │   │
│  │    状态: ✅ 已上传                                      │   │
│  │                                                         │   │
│  │    [📥 下载] [👁️ 预览] [🗑️ 删除]                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  OA集成状态                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 🔄 OA流程同步状态: 已同步                               │   │
│  │ 📋 OA审批单号: OA2024011501                            │   │
│  │ ⏰ 同步时间: 2024-01-15 15:00                          │   │
│  │                                                         │   │
│  │ [🔗 查看OA流程] [🔄 手动同步]                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 付款条款解析结果详细设计

```
┌─────────────────────────────────────────────────────────────────┐
│                  🔍 付款条款自动解析区域                         │
│                                                                 │
│  解析状态提示                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ℹ️ 系统将自动解析合同中的付款条款，生成项目节点配置建议。  │   │
│  │                                                         │   │
│  │ 📊 解析进度: ▓▓▓▓▓▓▓▓▓▓ 100%                          │   │
│  │ ✅ 解析完成，识别到 3 个付款节点                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  操作按钮区域                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [🔍 重新解析] [➕ 手动添加节点] [💾 保存解析结果]        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  解析结果表格                                                   │
│  ┌─────┬─────┬─────────────┬─────────────┬─────────────────┐   │
│  │序号  │节点名│付款比例(%)   │触发条件      │预计时间          │   │
│  │     │称   │             │             │                 │   │
│  ├─────┼─────┼─────────────┼─────────────┼─────────────────┤   │
│  │  1  │首付款│     30      │合同签订后    │2024-01-22       │   │
│  │     │     │             │7个工作日内   │                 │   │
│  │     │     │ [📝 编辑]   │             │ [📅 调整]       │   │
│  ├─────┼─────┼─────────────┼─────────────┼─────────────────┤   │
│  │  2  │中期款│     40      │项目进度达到  │2024-06-15       │   │
│  │     │     │             │50%          │                 │   │
│  │     │     │ [📝 编辑]   │             │ [📅 调整]       │   │
│  ├─────┼─────┼─────────────┼─────────────┼─────────────────┤   │
│  │  3  │尾款  │     30      │项目验收合格  │2024-12-01       │   │
│  │     │     │             │后10日内     │                 │   │
│  │     │     │ [📝 编辑]   │             │ [📅 调整]       │   │
│  └─────┴─────┴─────────────┴─────────────┴─────────────────┘   │
│                                                                 │
│  快速操作区域                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 💡 智能建议:                                           │   │
│  │ • 建议调整中期款触发条件为"设计评审通过"                │   │
│  │ • 建议增加"设备采购完成"节点，比例10%                   │   │
│  │                                                         │   │
│  │ [✅ 采纳建议] [❌ 忽略建议]                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  导航到节点配置                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [⚙️ 跳转到节点配置页面] [📋 生成节点模板]               │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 合同编辑弹窗设计

```
┌─────────────────────────────────────────────────────┐
│  📝 编辑付款条款                              ✖️   │
├─────────────────────────────────────────────────────┤
│                                                     │
│  节点基本信息                                       │
│  ┌─────────────────────────────────────────────┐   │
│  │ 节点名称: [中期款_____________________]     │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────┐ ┌─────────────────────────┐   │
│  │ 付款比例: [40]% │ │ 付款金额: [80] 万元      │   │
│  └─────────────────┘ └─────────────────────────┘   │
│                                                     │
│  触发条件设置                                       │
│  ┌─────────────────────────────────────────────┐   │
│  │ 条件类型: [进度条件_______________▼]        │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ 具体条件: [项目进度达到50%_______________] │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  时间设置                                           │
│  ┌─────────────────┐ ┌─────────────────────────┐   │
│  │ 预计时间: [____] │ │ 最晚时间: [____________] │   │
│  │   📅 2024-06-15 │ │   📅 2024-06-30        │   │
│  └─────────────────┘ └─────────────────────────┘   │
│                                                     │
│  风险评估                                           │
│  ┌─────────────────────────────────────────────┐   │
│  │ 风险等级: [中等_________________▼]         │   │
│  │ 风险说明: [项目进度可能受外部因素影响____] │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  备注信息                                           │
│  ┌─────────────────────────────────────────────┐   │
│  │ 需要提前准备相关验收材料和文档              │   │
│  │ ________________________________________ │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│               ┌────┐ ┌────┐                        │
│               │取消│ │保存│                        │
│               └────┘ └────┘                        │
└─────────────────────────────────────────────────────┘
```

## 📐 设计规格

### 🌈 色彩方案
- **页面背景**: `#f5f7fa` (浅灰蓝)
- **卡片背景**: `#ffffff` (纯白)
- **主色调**: `#234fa2` (深蓝色)
- **OA集成标识**: `#ff4d4f` (红色) - 突出显示OA对接功能
- **成功状态**: `#52c41a` (绿色)
- **警告状态**: `#faad14` (橙色)
- **文件上传区**: `#fafafa` (浅灰背景)

### 📏 尺寸规格
- **页面内边距**: 24px
- **卡片圆角**: 12px
- **文件上传区**: 高度 120px，虚线边框
- **表格行高**: 54px
- **按钮高度**: 32px
- **进度条高度**: 6px

### 📝 字体规格
- **页面标题**: 24px, font-weight: bold
- **页面描述**: 14px, color: #64748b
- **卡片标题**: 18px, font-weight: 600
- **表格内容**: 14px
- **文件信息**: 12px, color: #666
- **按钮文字**: 14px

### 🎨 特殊样式设计
- **OA标签**: 红色背景，白色文字，圆角标签
- **文件状态**: 绿色勾选图标 + 状态文字
- **解析进度**: 渐变色进度条
- **智能建议**: 浅蓝背景，左侧灯泡图标

## ⚡ 交互逻辑

### 🔄 页面内交互

1. **项目选择交互**
   - 下拉选择当前管理的项目
   - 切换项目时自动加载对应合同信息
   - 未选择项目时禁用操作功能
   - 项目信息显示和验证

2. **文件上传交互**
   - 拖拽上传和点击上传两种方式
   - 文件格式验证（PDF、DOC、DOCX）
   - 文件大小限制（50MB）
   - 上传进度显示和状态反馈

3. **合同文件管理**
   - 文件预览功能
   - 文件下载功能
   - 文件删除确认
   - 文件版本管理

### 🚀 OA系统集成交互

1. **OA流程同步**
   - 合同上传后自动同步到OA
   - 显示OA审批单号和状态
   - 手动同步功能
   - 同步状态实时更新

2. **OA状态显示**
   - 同步状态标识（已同步/未同步/同步中）
   - OA审批进度显示
   - 审批结果反馈
   - 异常状态处理

### 📊 条款解析功能

1. **自动解析交互**
   - 点击解析按钮触发AI解析
   - 解析进度实时显示
   - 解析结果表格展示
   - 解析失败重试机制

2. **解析结果管理**
   - 编辑解析出的付款条款
   - 手动添加遗漏的付款节点
   - 删除错误的解析结果
   - 智能建议采纳/忽略

3. **数据验证和优化**
   - 付款比例总和验证（必须=100%）
   - 时间逻辑校验
   - 条件冲突检测
   - 风险评估提示

## 🚀 页面间跳转

### 跳转路径设计

1. **节点配置跳转**
   - 跳转到节点管理页面：`/implementation/nodes?projectId=P001&source=contract`
   - 携带解析出的节点配置数据
   - 保持项目上下文信息

2. **OA系统跳转**
   - 跳转到OA审批页面（外部系统）
   - 新窗口打开OA系统链接
   - 传递合同审批单号

3. **模板管理跳转**
   - 跳转到节点模板库：`/implementation/template`
   - 用于保存当前解析结果为模板

### 数据传递机制
- 通过 `query` 参数传递项目ID
- 通过 `localStorage` 缓存解析结果
- 通过 `route.query.nodes` 传递节点配置

## 📱 响应式设计

### 大屏设备 (≥1200px)
- 三区域并列显示
- 表格完整展示所有列
- 文件预览侧边栏显示

### 中屏设备 (768px - 1199px)
- 上下布局排列
- 表格部分列合并显示
- 文件预览弹窗显示

### 小屏设备 (≤767px)
- 卡片式堆叠布局
- 表格改为列表形式
- 操作按钮简化

## 🛠️ 技术实现

### 核心技术栈
- **Vue 3** + Composition API
- **Ant Design Vue** 组件库
- **文件上传**: Ant Design Upload组件
- **AI解析**: 集成AI服务API（规划中）
- **OA集成**: RESTful API接口

### 组件架构
1. **主页面** - 布局和数据管理
2. **文件上传组件** - 自定义文件管理
3. **条款表格组件** - 可编辑表格
4. **解析进度组件** - 进度显示和状态管理

### 关键功能实现

1. **文件管理功能**
```javascript
// 文件上传前验证
const beforeUploadContract = (file) => {
  const isValidType = ['application/pdf', 'application/msword', 
                      'application/vnd.openxmlformats-officedocument.wordprocessingml.document']
                     .includes(file.type)
  const isValidSize = file.size / 1024 / 1024 < 50 // 50MB限制
  
  if (!isValidType) {
    message.error('只支持 PDF、DOC、DOCX 格式文件')
    return false
  }
  if (!isValidSize) {
    message.error('文件大小不能超过 50MB')
    return false
  }
  return false // 阻止自动上传，使用自定义上传逻辑
}
```

2. **AI条款解析功能**
```javascript
// 调用AI解析API
const parseContractClauses = async () => {
  if (!contractFile.value) {
    message.error('请先上传合同文件')
    return
  }
  
  try {
    parseProgress.value = 0
    const response = await contractAPI.parseDocument({
      file: contractFile.value,
      projectId: selectedProjectId.value
    })
    
    clauses.value = response.data.clauses
    parseProgress.value = 100
    message.success('合同条款解析完成')
  } catch (error) {
    message.error('解析失败，请重试')
  }
}
```

3. **OA系统集成**
```javascript
// OA流程同步
const syncToOA = async () => {
  try {
    const response = await oaAPI.createApprovalFlow({
      projectId: selectedProjectId.value,
      contractFile: contractFile.value,
      type: 'CONTRACT_APPROVAL'
    })
    
    oaStatus.value = {
      synced: true,
      approvalId: response.data.approvalId,
      syncTime: new Date().toISOString()
    }
    
    message.success('已同步到OA系统')
  } catch (error) {
    message.error('OA同步失败')
  }
}
```

### 数据模型设计

```javascript
// 合同信息数据模型
const contractInfo = {
  projectId: 'P001',                    // 项目ID
  contractFile: {...},                  // 合同文件对象
  oaStatus: {                          // OA同步状态
    synced: true,
    approvalId: 'OA2024011501',
    syncTime: '2024-01-15T15:00:00Z'
  },
  clauses: [                           // 解析出的条款
    {
      id: 'C001',
      name: '首付款',
      percent: 30,
      condition: '合同签订后7日内',
      estimatedDate: '2024-01-22',
      riskLevel: 'low'
    }
  ],
  parseStatus: {                       // 解析状态
    progress: 100,
    completed: true,
    suggestions: []
  }
}
```

## 🎯 用户体验亮点

1. **一站式合同管理**
   - 文件上传、预览、下载一体化
   - OA流程无缝集成
   - 智能解析减少手工录入

2. **智能条款解析**
   - AI自动识别付款条款
   - 智能建议优化配置
   - 实时进度反馈

3. **高效的数据流转**
   - 解析结果直接导入节点配置
   - 与OA系统数据同步
   - 避免重复录入工作

4. **完善的验证机制**
   - 文件格式和大小验证
   - 付款比例逻辑校验
   - 风险提示和建议

## 📋 待优化项

1. **AI解析能力增强**
   - 支持更多合同格式识别
   - 提高条款解析准确率
   - 增加合同风险点识别

2. **OA集成深度优化**
   - 实时审批状态同步
   - 审批意见自动回写
   - 多OA系统适配

3. **文件管理功能完善**
   - 文件版本控制
   - 在线编辑和批注
   - 电子签名集成

4. **数据安全保障**
   - 文件加密存储
   - 访问权限控制
   - 操作日志审计

## 🔗 关联模块说明

### 上游数据来源
- **项目实施中心**: 获取项目基本信息
- **立项管理**: 获取项目预算和基础数据

### 下游数据输出
- **节点管理**: 输出解析的付款节点配置
- **付款管理**: 提供付款计划和条款
- **进度管理**: 提供合同里程碑节点

### 外部系统集成
- **OA系统**: 合同审批流程同步
- **AI解析服务**: 合同文档智能解析
- **文件存储系统**: 合同文件安全存储 